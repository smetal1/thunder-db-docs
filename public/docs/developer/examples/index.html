<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head><script src="/docs/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=docs/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/svg+xml" href="/docs/favicons/favicon.svg">
<link rel="icon" type="image/x-icon" href="/docs/favicons/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/docs/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/docs/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="256x256" href="/docs/favicons/favicon-256.png">
<link rel="apple-touch-icon" sizes="180x180" href="/docs/favicons/apple-touch-icon.png">
<link rel="manifest" href="/docs/favicons/site.webmanifest">
<meta name="theme-color" content="#0D0D0D">
<meta name="msapplication-TileColor" content="#0D0D0D">

<title>Examples &amp; Use Cases | ThunderDB Documentation</title>
<meta name="description" content="End-to-end application examples demonstrating ThunderDB for e-commerce, analytics, RAG pipelines, data federation, CDC, caching, and IoT.">
<meta property="og:url" content="http://localhost:1313/docs/docs/developer/examples/">
  <meta property="og:site_name" content="ThunderDB Documentation">
  <meta property="og:title" content="Examples & Use Cases">
  <meta property="og:description" content="End-to-end application examples demonstrating ThunderDB for e-commerce, analytics, RAG pipelines, data federation, CDC, caching, and IoT.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Examples & Use Cases">
  <meta itemprop="description" content="End-to-end application examples demonstrating ThunderDB for e-commerce, analytics, RAG pipelines, data federation, CDC, caching, and IoT.">
  <meta itemprop="wordCount" content="5194">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Examples & Use Cases">
  <meta name="twitter:description" content="End-to-end application examples demonstrating ThunderDB for e-commerce, analytics, RAG pipelines, data federation, CDC, caching, and IoT.">
<link href="/docs/scss/main.css" rel="stylesheet">
<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="td-navbar-container container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/docs/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 64" width="300" height="64"><defs><symbol id="b" viewBox="0 0 5 5" overflow="visible"><rect y=".3" width="4.8" height="4.9" rx=".55" fill="#331500" opacity=".6"/><rect width="4.8" height="4.8" rx=".55" fill="#FF6B00"/><rect width="4.8" height=".6" rx=".55" fill="#FA4" opacity=".5"/><rect y=".6" width="4.8" height=".5" rx=".3" fill="#F83" opacity=".3"/><rect y="4" width="4.8" height=".8" rx=".4" fill="#930" opacity=".35"/><circle cx="2.4" cy="2.55" r="1.15" fill="#D50"/><circle cx="2.4" cy="2.55" r="1.15" fill="none" stroke="rgba(255,200,100,0.3)" stroke-width=".3"/><circle cx="2" cy="2.15" r=".4" fill="#FC8" opacity=".55"/></symbol><symbol id="c" viewBox="0 0 5 5" overflow="visible"><rect y=".3" width="4.8" height="4.9" rx=".55" fill="#4D3000" opacity=".6"/><rect width="4.8" height="4.8" rx=".55" fill="#FA0"/><rect width="4.8" height=".6" rx=".55" fill="#FD6" opacity=".55"/><rect y=".6" width="4.8" height=".5" rx=".3" fill="#FB3" opacity=".3"/><rect y="4" width="4.8" height=".8" rx=".4" fill="#960" opacity=".3"/><circle cx="2.4" cy="2.55" r="1.15" fill="#D80"/><circle cx="2.4" cy="2.55" r="1.15" fill="none" stroke="rgba(255,230,150,0.35)" stroke-width=".3"/><circle cx="2" cy="2.15" r=".4" fill="#FE9" opacity=".6"/></symbol></defs><use href="#b" x="35" y="2" width="5" height="5"/><use href="#b" x="41" y="2" width="5" height="5"/><use href="#b" x="29" y="8" width="5" height="5"/><use href="#b" x="35" y="8" width="5" height="5"/><use href="#b" x="23" y="14" width="5" height="5"/><use href="#b" x="29" y="14" width="5" height="5"/><use href="#b" x="17" y="20" width="5" height="5"/><use href="#b" x="23" y="20" width="5" height="5"/><use href="#c" x="5" y="26" width="5" height="5"/><use href="#c" x="11" y="26" width="5" height="5"/><use href="#c" x="17" y="26" width="5" height="5"/><use href="#c" x="23" y="26" width="5" height="5"/><use href="#c" x="29" y="26" width="5" height="5"/><use href="#c" x="35" y="26" width="5" height="5"/><use href="#c" x="41" y="26" width="5" height="5"/><use href="#c" x="47" y="26" width="5" height="5"/><use href="#b" x="35" y="32" width="5" height="5"/><use href="#b" x="41" y="32" width="5" height="5"/><use href="#b" x="29" y="38" width="5" height="5"/><use href="#b" x="35" y="38" width="5" height="5"/><use href="#b" x="23" y="44" width="5" height="5"/><use href="#b" x="29" y="44" width="5" height="5"/><use href="#b" x="17" y="50" width="5" height="5"/><use href="#b" x="23" y="50" width="5" height="5"/><use href="#b" x="11" y="56" width="5" height="5"/><use href="#b" x="17" y="56" width="5" height="5"/><text x="66" y="43" font-family="'SF Mono','Fira Code','Consolas','Courier New',monospace" font-size="27" font-weight="900" letter-spacing=".5"><tspan fill="#FFF">Thunder</tspan><tspan fill="#FF6B00">DB</tspan></text></svg></span><span class="navbar-brand__name">ThunderDB Documentation</span></a>
  <div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id="main_navbar">
    <div class="scroll-indicator scroll-left"></div>
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/docs/"><span>Documentation</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs/docs/architecture/"><span>Architecture</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs/docs/developer/api-reference/"><span>API Reference</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/docs/about/"><span>About</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/thunderdb/thunderdb" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      </ul>
    <div class="scroll-indicator scroll-right"></div>
  </div>
  <div class="d-none d-lg-block td-navbar__search">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/docs/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main" data-bs-spy="scroll" data-bs-target=".td-toc" data-bs-root-margin="0px 0px -10%">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
  <script>
    $(function() {
    $("#td-section-nav a").removeClass("active");
    $("#td-section-nav #m-docsdocsdeveloperexamples").addClass("active");
    $("#td-section-nav #m-docsdocsdeveloperexamples-li span").addClass("td-sidebar-nav-active-item");
    $("#td-section-nav #m-docsdocsdeveloperexamples").parents("li").addClass("active-path");
    $("#td-section-nav li.active-path").addClass("show");
    $("#td-section-nav li.active-path").children("input").prop('checked', true);
    $("#td-section-nav #m-docsdocsdeveloperexamples-li").siblings("li").addClass("show");
    $("#td-section-nav #m-docsdocsdeveloperexamples-li").children("ul").children("li").addClass("show");
    $("#td-sidebar-menu").toggleClass("d-none");
    });
  </script>
  <div id="td-sidebar-menu" class="td-sidebar__inner d-none">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/docs/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdocs-li">
    <a href="/docs/docs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docsdocs"><span class="">Documentation</span></a>
    <ul class="ul-1">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsgetting-started-li">
    <input type="checkbox" id="m-docsdocsgetting-started-check"/>
    <label for="m-docsdocsgetting-started-check"><a href="/docs/docs/getting-started/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsgetting-started"><span class="">Getting Started</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsarchitecture-li">
    <input type="checkbox" id="m-docsdocsarchitecture-check"/>
    <label for="m-docsdocsarchitecture-check"><a href="/docs/docs/architecture/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsarchitecture"><span class="">Architecture</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdocsdeveloper-li">
    <input type="checkbox" id="m-docsdocsdeveloper-check"/>
    <label for="m-docsdocsdeveloper-check"><a href="/docs/docs/developer/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsdeveloper"><span class="">Developer Guide</span></a></label>
    
    <ul class="ul-2 foldable">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsdeveloperapi-reference-li">
    <input type="checkbox" id="m-docsdocsdeveloperapi-reference-check"/>
    <label for="m-docsdocsdeveloperapi-reference-check"><a href="/docs/docs/developer/api-reference/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsdeveloperapi-reference"><span class="">API Reference</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsdevelopersql-reference-li">
    <input type="checkbox" id="m-docsdocsdevelopersql-reference-check"/>
    <label for="m-docsdocsdevelopersql-reference-check"><a href="/docs/docs/developer/sql-reference/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsdevelopersql-reference"><span class="">SQL Reference</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsdevelopersdk-li">
    <input type="checkbox" id="m-docsdocsdevelopersdk-check"/>
    <label for="m-docsdocsdevelopersdk-check"><a href="/docs/docs/developer/sdk/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsdevelopersdk"><span class="">SDKs &amp; Drivers</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsdeveloperexamples-li">
    <input type="checkbox" id="m-docsdocsdeveloperexamples-check"/>
    <label for="m-docsdocsdeveloperexamples-check"><a href="/docs/docs/developer/examples/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsdeveloperexamples"><span class="">Examples &amp; Use Cases</span></a></label>
    
  </li>
    </ul>
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdocsadministrator-li">
    <input type="checkbox" id="m-docsdocsadministrator-check"/>
    <label for="m-docsdocsadministrator-check"><a href="/docs/docs/administrator/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministrator"><span class="">Administrator Guide</span></a></label>
    
    <ul class="ul-2 foldable">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratordeployment-li">
    <input type="checkbox" id="m-docsdocsadministratordeployment-check"/>
    <label for="m-docsdocsadministratordeployment-check"><a href="/docs/docs/administrator/deployment/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratordeployment"><span class="">Deployment</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratorconfiguration-li">
    <input type="checkbox" id="m-docsdocsadministratorconfiguration-check"/>
    <label for="m-docsdocsadministratorconfiguration-check"><a href="/docs/docs/administrator/configuration/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratorconfiguration"><span class="">Configuration</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratormonitoring-li">
    <input type="checkbox" id="m-docsdocsadministratormonitoring-check"/>
    <label for="m-docsdocsadministratormonitoring-check"><a href="/docs/docs/administrator/monitoring/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratormonitoring"><span class="">Monitoring</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratorbackup-recovery-li">
    <input type="checkbox" id="m-docsdocsadministratorbackup-recovery-check"/>
    <label for="m-docsdocsadministratorbackup-recovery-check"><a href="/docs/docs/administrator/backup-recovery/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratorbackup-recovery"><span class="">Backup &amp; Recovery</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratorsecurity-li">
    <input type="checkbox" id="m-docsdocsadministratorsecurity-check"/>
    <label for="m-docsdocsadministratorsecurity-check"><a href="/docs/docs/administrator/security/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratorsecurity"><span class="">Security</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocsadministratortroubleshooting-li">
    <input type="checkbox" id="m-docsdocsadministratortroubleshooting-check"/>
    <label for="m-docsdocsadministratortroubleshooting-check"><a href="/docs/docs/administrator/troubleshooting/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocsadministratortroubleshooting"><span class="">Troubleshooting</span></a></label>
    
  </li>
    </ul>
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsdocscontributor-li">
    <input type="checkbox" id="m-docsdocscontributor-check"/>
    <label for="m-docsdocscontributor-check"><a href="/docs/docs/contributor/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocscontributor"><span class="">Contributor Guide</span></a></label>
    
    <ul class="ul-2 foldable">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocscontributordevelopment-setup-li">
    <input type="checkbox" id="m-docsdocscontributordevelopment-setup-check"/>
    <label for="m-docsdocscontributordevelopment-setup-check"><a href="/docs/docs/contributor/development-setup/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocscontributordevelopment-setup"><span class="">Development Setup</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocscontributorcodebase-guide-li">
    <input type="checkbox" id="m-docsdocscontributorcodebase-guide-check"/>
    <label for="m-docsdocscontributorcodebase-guide-check"><a href="/docs/docs/contributor/codebase-guide/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocscontributorcodebase-guide"><span class="">Codebase Guide</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocscontributortesting-li">
    <input type="checkbox" id="m-docsdocscontributortesting-check"/>
    <label for="m-docsdocscontributortesting-check"><a href="/docs/docs/contributor/testing/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocscontributortesting"><span class="">Testing</span></a></label>
    
  </li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsdocscontributorrelease-process-li">
    <input type="checkbox" id="m-docsdocscontributorrelease-process-check"/>
    <label for="m-docsdocscontributorrelease-process-check"><a href="/docs/docs/contributor/release-process/" class="align-left ps-0  td-sidebar-link td-sidebar-link__section" id="m-docsdocscontributorrelease-process"><span class="">Release Process</span></a></label>
    
  </li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/thunderdb/thunderdb/tree/main/content/docs/developer/examples/_index.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/thunderdb/thunderdb/edit/main/content/docs/developer/examples/_index.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  <a href="https://github.com/thunderdb/thunderdb/new/main/content/docs/developer/examples?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/thunderdb/thunderdb/issues/new?title=Examples%20&amp;%20Use%20Cases" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/thunderdb/thunderdb/issues/new" class="td-page-meta--project td-page-meta__project-issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
  
</div>

            <div class="td-toc" data-proofer-ignore>
<div class="td-toc-title">
      <span class="td-toc-title__text">On this page</span>
      <a class="td-toc-title__link" title="Top of page" href="#"></a>
    </div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-e-commerce-application-oltp">1. E-Commerce Application (OLTP)</a>
      <ul>
        <li><a href="#description">Description</a></li>
        <li><a href="#schema">Schema</a></li>
        <li><a href="#sample-data">Sample Data</a></li>
        <li><a href="#queries">Queries</a></li>
      </ul>
    </li>
    <li><a href="#2-analytics-dashboard-olap">2. Analytics Dashboard (OLAP)</a>
      <ul>
        <li><a href="#description-1">Description</a></li>
        <li><a href="#schema-1">Schema</a></li>
        <li><a href="#sample-data-1">Sample Data</a></li>
        <li><a href="#queries-1">Queries</a></li>
      </ul>
    </li>
    <li><a href="#3-aiml-rag-pipeline-vector-search">3. AI/ML RAG Pipeline (Vector Search)</a>
      <ul>
        <li><a href="#description-2">Description</a></li>
        <li><a href="#schema-2">Schema</a></li>
        <li><a href="#sample-data-2">Sample Data</a></li>
        <li><a href="#queries-2">Queries</a></li>
      </ul>
    </li>
    <li><a href="#4-multi-database-federation-fdw">4. Multi-Database Federation (FDW)</a>
      <ul>
        <li><a href="#description-3">Description</a></li>
        <li><a href="#schema-3">Schema</a></li>
        <li><a href="#sample-data-3">Sample Data</a></li>
        <li><a href="#queries-3">Queries</a></li>
      </ul>
    </li>
    <li><a href="#5-real-time-sync-cdc">5. Real-Time Sync (CDC)</a>
      <ul>
        <li><a href="#description-4">Description</a></li>
        <li><a href="#schema-4">Schema</a></li>
        <li><a href="#setting-up-cdc-subscriptions">Setting Up CDC Subscriptions</a></li>
        <li><a href="#simulating-changes">Simulating Changes</a></li>
        <li><a href="#cdc-event-payloads">CDC Event Payloads</a></li>
        <li><a href="#analytics-query-on-synced-data">Analytics Query on Synced Data</a></li>
      </ul>
    </li>
    <li><a href="#6-caching-layer-resp-protocol">6. Caching Layer (RESP Protocol)</a>
      <ul>
        <li><a href="#description-5">Description</a></li>
        <li><a href="#schema-5">Schema</a></li>
        <li><a href="#redis-operations">Redis Operations</a></li>
        <li><a href="#sql-queries-over-cached-data">SQL Queries Over Cached Data</a></li>
      </ul>
    </li>
    <li><a href="#7-iot-data-platform">7. IoT Data Platform</a>
      <ul>
        <li><a href="#description-6">Description</a></li>
        <li><a href="#schema-6">Schema</a></li>
        <li><a href="#sample-data-4">Sample Data</a></li>
        <li><a href="#queries-4">Queries</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>

            

          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/docs/docs/">Documentation</a></li>
  <li class="breadcrumb-item">
    <a href="/docs/docs/developer/">Developer Guide</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    Examples &amp; Use Cases</li>
  </ol>
</nav>
<div class="td-content">
	<h1>Examples &amp; Use Cases</h1>
  <div class="lead">End-to-end application examples demonstrating ThunderDB for e-commerce, analytics, RAG pipelines, data federation, CDC, caching, and IoT.</div>
	<header class="article-meta">
		
</header>
	<h1 id="examples--use-cases">Examples &amp; Use Cases</h1>
<p>This section provides complete, runnable examples for seven common application patterns. Each example includes the schema design, sample data, queries, and expected output so you can follow along against a local ThunderDB instance.</p>
<hr>
<h2 id="1-e-commerce-application-oltp">1. E-Commerce Application (OLTP)</h2>
<p>An online store with users, products, orders, and real-time inventory management. This example demonstrates ThunderDB&rsquo;s transactional capabilities with row-oriented storage.</p>
<h3 id="description">Description</h3>
<p>A typical e-commerce backend needs fast point lookups for product pages, ACID transactions for order placement (decrement inventory atomically), and efficient queries for user order history. ThunderDB&rsquo;s row-oriented engine handles all of these in a single system.</p>
<h3 id="schema">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Users table
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> users (
</span></span><span style="display:flex;"><span>    id         <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    name       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    email      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">UNIQUE</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    membership <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#39;standard&#39;</span>,
</span></span><span style="display:flex;"><span>    created_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Product catalog
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> products (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    name        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    description <span style="color:#8be9fd;font-style:italic">TEXT</span>,
</span></span><span style="display:flex;"><span>    price       <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    category    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">100</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    created_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Inventory (separate for concurrency)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> inventory (
</span></span><span style="display:flex;"><span>    product_id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span> <span style="color:#ff79c6">REFERENCES</span> products(id),
</span></span><span style="display:flex;"><span>    quantity   INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">CHECK</span> (quantity <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">0</span>),
</span></span><span style="display:flex;"><span>    reserved   INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>    warehouse  <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Orders
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> orders (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    customer_id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> users(id),
</span></span><span style="display:flex;"><span>    status      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#39;pending&#39;</span>,
</span></span><span style="display:flex;"><span>    total       <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    created_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now(),
</span></span><span style="display:flex;"><span>    updated_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Order line items
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> order_items (
</span></span><span style="display:flex;"><span>    id         <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    order_id   <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> orders(id) <span style="color:#ff79c6">ON</span> <span style="color:#ff79c6">DELETE</span> <span style="color:#ff79c6">CASCADE</span>,
</span></span><span style="display:flex;"><span>    product_id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> products(id),
</span></span><span style="display:flex;"><span>    quantity   INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">CHECK</span> (quantity <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span>),
</span></span><span style="display:flex;"><span>    unit_price <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Indexes
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_orders_customer <span style="color:#ff79c6">ON</span> orders (customer_id);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_orders_status <span style="color:#ff79c6">ON</span> orders (status);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_order_items_order <span style="color:#ff79c6">ON</span> order_items (order_id);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_products_category <span style="color:#ff79c6">ON</span> products (category);
</span></span></code></pre></div><h3 id="sample-data">Sample Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Users
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> users (id, name, email, membership) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;Alice Johnson&#39;</span>, <span style="color:#f1fa8c">&#39;alice@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;gold&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;Bob Smith&#39;</span>, <span style="color:#f1fa8c">&#39;bob@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;standard&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;Carol White&#39;</span>, <span style="color:#f1fa8c">&#39;carol@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;gold&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#39;Dave Brown&#39;</span>, <span style="color:#f1fa8c">&#39;dave@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;platinum&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Products
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> products (id, name, description, price, category) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">101</span>, <span style="color:#f1fa8c">&#39;Wireless Mouse&#39;</span>, <span style="color:#f1fa8c">&#39;Ergonomic wireless mouse with USB-C&#39;</span>, <span style="color:#bd93f9">29</span>.<span style="color:#bd93f9">99</span>, <span style="color:#f1fa8c">&#39;electronics&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">102</span>, <span style="color:#f1fa8c">&#39;Mechanical Keyboard&#39;</span>, <span style="color:#f1fa8c">&#39;Cherry MX Blue switches, RGB&#39;</span>, <span style="color:#bd93f9">149</span>.<span style="color:#bd93f9">99</span>, <span style="color:#f1fa8c">&#39;electronics&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">103</span>, <span style="color:#f1fa8c">&#39;Python Cookbook&#39;</span>, <span style="color:#f1fa8c">&#39;Advanced Python recipes, 3rd edition&#39;</span>, <span style="color:#bd93f9">45</span>.<span style="color:#bd93f9">00</span>, <span style="color:#f1fa8c">&#39;books&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">104</span>, <span style="color:#f1fa8c">&#39;Standing Desk&#39;</span>, <span style="color:#f1fa8c">&#39;Electric height-adjustable, 60 inch&#39;</span>, <span style="color:#bd93f9">599</span>.<span style="color:#bd93f9">99</span>, <span style="color:#f1fa8c">&#39;furniture&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">105</span>, <span style="color:#f1fa8c">&#39;USB-C Hub&#39;</span>, <span style="color:#f1fa8c">&#39;7-port USB-C dock with HDMI&#39;</span>, <span style="color:#bd93f9">79</span>.<span style="color:#bd93f9">99</span>, <span style="color:#f1fa8c">&#39;electronics&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Inventory
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> inventory (product_id, quantity, reserved, warehouse) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">101</span>, <span style="color:#bd93f9">500</span>, <span style="color:#bd93f9">12</span>, <span style="color:#f1fa8c">&#39;warehouse-east&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">102</span>, <span style="color:#bd93f9">200</span>, <span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;warehouse-east&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">103</span>, <span style="color:#bd93f9">1000</span>, <span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;warehouse-west&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">104</span>, <span style="color:#bd93f9">50</span>, <span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;warehouse-west&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">105</span>, <span style="color:#bd93f9">350</span>, <span style="color:#bd93f9">8</span>, <span style="color:#f1fa8c">&#39;warehouse-east&#39;</span>);
</span></span></code></pre></div><h3 id="queries">Queries</h3>
<p><strong>Place an order (transactional):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">BEGIN</span> <span style="color:#ff79c6">TRANSACTION</span> <span style="color:#ff79c6">ISOLATION</span> <span style="color:#ff79c6">LEVEL</span> <span style="color:#ff79c6">SERIALIZABLE</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Check inventory
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> quantity <span style="color:#ff79c6">-</span> reserved <span style="color:#ff79c6">AS</span> available
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> inventory
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> product_id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">102</span>;
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Returns: available = 195
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Reserve inventory
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">UPDATE</span> inventory
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> reserved <span style="color:#ff79c6">=</span> reserved <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> product_id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">102</span> <span style="color:#ff79c6">AND</span> (quantity <span style="color:#ff79c6">-</span> reserved) <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Create the order
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> orders (id, customer_id, status, total)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">1001</span>, <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;confirmed&#39;</span>, <span style="color:#bd93f9">149</span>.<span style="color:#bd93f9">99</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> order_items (id, order_id, product_id, quantity, unit_price)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">5001</span>, <span style="color:#bd93f9">1001</span>, <span style="color:#bd93f9">102</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">149</span>.<span style="color:#bd93f9">99</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">COMMIT</span>;
</span></span></code></pre></div><p><strong>User order history:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    o.id <span style="color:#ff79c6">AS</span> order_id,
</span></span><span style="display:flex;"><span>    o.status,
</span></span><span style="display:flex;"><span>    o.total,
</span></span><span style="display:flex;"><span>    o.created_at,
</span></span><span style="display:flex;"><span>    jsonb_agg(jsonb_build_object(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;product&#39;</span>, p.name,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;quantity&#39;</span>, oi.quantity,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;price&#39;</span>, oi.unit_price
</span></span><span style="display:flex;"><span>    )) <span style="color:#ff79c6">AS</span> items
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> orders o
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> order_items oi <span style="color:#ff79c6">ON</span> o.id <span style="color:#ff79c6">=</span> oi.order_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> products p <span style="color:#ff79c6">ON</span> oi.product_id <span style="color:#ff79c6">=</span> p.id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> o.customer_id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> o.id, o.status, o.total, o.created_at
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> o.created_at <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> order_id | status    | total  | created_at               | items
</span></span><span style="display:flex;"><span>----------+-----------+--------+--------------------------+-----------------------------------------------
</span></span><span style="display:flex;"><span>     1001 | confirmed | 149.99 | 2025-12-15 10:30:00+00   | [{&#34;price&#34;: 149.99, &#34;product&#34;: &#34;Mechanical Keyboard&#34;, &#34;quantity&#34;: 1}]
</span></span></code></pre></div><p><strong>Low-stock alert:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    p.id,
</span></span><span style="display:flex;"><span>    p.name,
</span></span><span style="display:flex;"><span>    p.category,
</span></span><span style="display:flex;"><span>    i.quantity,
</span></span><span style="display:flex;"><span>    i.reserved,
</span></span><span style="display:flex;"><span>    i.quantity <span style="color:#ff79c6">-</span> i.reserved <span style="color:#ff79c6">AS</span> available,
</span></span><span style="display:flex;"><span>    i.warehouse
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> products p
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> inventory i <span style="color:#ff79c6">ON</span> p.id <span style="color:#ff79c6">=</span> i.product_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> (i.quantity <span style="color:#ff79c6">-</span> i.reserved) <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> available <span style="color:#ff79c6">ASC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> id  | name          | category  | quantity | reserved | available | warehouse
</span></span><span style="display:flex;"><span>-----+---------------+-----------+----------+----------+-----------+----------------
</span></span><span style="display:flex;"><span> 104 | Standing Desk | furniture |       50 |        3 |        47 | warehouse-west
</span></span></code></pre></div><hr>
<h2 id="2-analytics-dashboard-olap">2. Analytics Dashboard (OLAP)</h2>
<p>An analytics platform that ingests high volumes of events and serves aggregate dashboards. This example demonstrates ThunderDB&rsquo;s columnar storage engine for analytical workloads.</p>
<h3 id="description-1">Description</h3>
<p>Analytics dashboards need to scan millions of rows, compute aggregations by various dimensions (time, geography, device), and return results in sub-second latency. ThunderDB&rsquo;s columnar engine stores data in compressed columns with BRIN indexes, making it ideal for time-series analytics.</p>
<h3 id="schema-1">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Columnar table for events (optimized for scans)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> analytics_events (
</span></span><span style="display:flex;"><span>    event_id    <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    user_id     <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    session_id  UUID,
</span></span><span style="display:flex;"><span>    event_type  <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    page_url    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">500</span>),
</span></span><span style="display:flex;"><span>    referrer    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">500</span>),
</span></span><span style="display:flex;"><span>    device_type <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>),
</span></span><span style="display:flex;"><span>    country     <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>    city        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">100</span>),
</span></span><span style="display:flex;"><span>    properties  JSONB,
</span></span><span style="display:flex;"><span>    occurred_at TIMESTAMPTZ <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#ff79c6">=</span> COLUMNAR;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- BRIN index on timestamp for efficient time range scans
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_events_time <span style="color:#ff79c6">ON</span> analytics_events <span style="color:#ff79c6">USING</span> BRIN (occurred_at)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WITH</span> (pages_per_range <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">32</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- B-tree index for event type filtering
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_events_type <span style="color:#ff79c6">ON</span> analytics_events (event_type);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Daily revenue materialization
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> daily_revenue (
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">date</span>      <span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    revenue   <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">12</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    orders    INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    avg_order <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#ff79c6">=</span> COLUMNAR;
</span></span></code></pre></div><h3 id="sample-data-1">Sample Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> analytics_events (event_id, user_id, session_id, event_type, page_url, device_type, country, city, properties, occurred_at) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1001</span>, <span style="color:#f1fa8c">&#39;a1b2c3d4-e5f6-7890-abcd-ef1234567890&#39;</span>, <span style="color:#f1fa8c">&#39;page_view&#39;</span>, <span style="color:#f1fa8c">&#39;/products/102&#39;</span>, <span style="color:#f1fa8c">&#39;desktop&#39;</span>, <span style="color:#f1fa8c">&#39;US&#39;</span>, <span style="color:#f1fa8c">&#39;New York&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;duration_ms&#34;: 4500}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1001</span>, <span style="color:#f1fa8c">&#39;a1b2c3d4-e5f6-7890-abcd-ef1234567890&#39;</span>, <span style="color:#f1fa8c">&#39;add_to_cart&#39;</span>, <span style="color:#f1fa8c">&#39;/products/102&#39;</span>, <span style="color:#f1fa8c">&#39;desktop&#39;</span>, <span style="color:#f1fa8c">&#39;US&#39;</span>, <span style="color:#f1fa8c">&#39;New York&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;product_id&#34;: 102, &#34;price&#34;: 149.99}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:02:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">1002</span>, <span style="color:#f1fa8c">&#39;b2c3d4e5-f6a7-8901-bcde-f12345678901&#39;</span>, <span style="color:#f1fa8c">&#39;page_view&#39;</span>, <span style="color:#f1fa8c">&#39;/products/101&#39;</span>, <span style="color:#f1fa8c">&#39;mobile&#39;</span>, <span style="color:#f1fa8c">&#39;GB&#39;</span>, <span style="color:#f1fa8c">&#39;London&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;duration_ms&#34;: 2100}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:05:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">1003</span>, <span style="color:#f1fa8c">&#39;c3d4e5f6-a7b8-9012-cdef-123456789012&#39;</span>, <span style="color:#f1fa8c">&#39;purchase&#39;</span>, <span style="color:#f1fa8c">&#39;/checkout&#39;</span>, <span style="color:#f1fa8c">&#39;desktop&#39;</span>, <span style="color:#f1fa8c">&#39;US&#39;</span>, <span style="color:#f1fa8c">&#39;San Francisco&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;order_id&#34;: 1001, &#34;total&#34;: 149.99}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:10:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">1002</span>, <span style="color:#f1fa8c">&#39;b2c3d4e5-f6a7-8901-bcde-f12345678901&#39;</span>, <span style="color:#f1fa8c">&#39;page_view&#39;</span>, <span style="color:#f1fa8c">&#39;/&#39;</span>, <span style="color:#f1fa8c">&#39;mobile&#39;</span>, <span style="color:#f1fa8c">&#39;GB&#39;</span>, <span style="color:#f1fa8c">&#39;London&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;duration_ms&#34;: 800}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:12:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">1004</span>, <span style="color:#f1fa8c">&#39;d4e5f6a7-b8c9-0123-defa-234567890123&#39;</span>, <span style="color:#f1fa8c">&#39;signup&#39;</span>, <span style="color:#f1fa8c">&#39;/register&#39;</span>, <span style="color:#f1fa8c">&#39;tablet&#39;</span>, <span style="color:#f1fa8c">&#39;DE&#39;</span>, <span style="color:#f1fa8c">&#39;Berlin&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;source&#34;: &#34;google_ads&#34;}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:15:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">1004</span>, <span style="color:#f1fa8c">&#39;d4e5f6a7-b8c9-0123-defa-234567890123&#39;</span>, <span style="color:#f1fa8c">&#39;page_view&#39;</span>, <span style="color:#f1fa8c">&#39;/products&#39;</span>, <span style="color:#f1fa8c">&#39;tablet&#39;</span>, <span style="color:#f1fa8c">&#39;DE&#39;</span>, <span style="color:#f1fa8c">&#39;Berlin&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;duration_ms&#34;: 3200}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:16:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">8</span>, <span style="color:#bd93f9">1001</span>, <span style="color:#f1fa8c">&#39;a1b2c3d4-e5f6-7890-abcd-ef1234567890&#39;</span>, <span style="color:#f1fa8c">&#39;purchase&#39;</span>, <span style="color:#f1fa8c">&#39;/checkout&#39;</span>, <span style="color:#f1fa8c">&#39;desktop&#39;</span>, <span style="color:#f1fa8c">&#39;US&#39;</span>, <span style="color:#f1fa8c">&#39;New York&#39;</span>, <span style="color:#f1fa8c">&#39;{&#34;order_id&#34;: 1002, &#34;total&#34;: 79.99}&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:20:00+00&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> daily_revenue (<span style="color:#8be9fd;font-style:italic">date</span>, revenue, orders, avg_order) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-01&#39;</span>, <span style="color:#bd93f9">12450</span>.<span style="color:#bd93f9">00</span>, <span style="color:#bd93f9">85</span>, <span style="color:#bd93f9">146</span>.<span style="color:#bd93f9">47</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-02&#39;</span>, <span style="color:#bd93f9">14200</span>.<span style="color:#bd93f9">50</span>, <span style="color:#bd93f9">102</span>, <span style="color:#bd93f9">139</span>.<span style="color:#bd93f9">22</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-03&#39;</span>, <span style="color:#bd93f9">11890</span>.<span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">78</span>, <span style="color:#bd93f9">152</span>.<span style="color:#bd93f9">44</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-04&#39;</span>, <span style="color:#bd93f9">15600</span>.<span style="color:#bd93f9">00</span>, <span style="color:#bd93f9">112</span>, <span style="color:#bd93f9">139</span>.<span style="color:#bd93f9">29</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-05&#39;</span>, <span style="color:#bd93f9">13100</span>.<span style="color:#bd93f9">75</span>, <span style="color:#bd93f9">91</span>, <span style="color:#bd93f9">143</span>.<span style="color:#bd93f9">96</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-06&#39;</span>, <span style="color:#bd93f9">9800</span>.<span style="color:#bd93f9">00</span>, <span style="color:#bd93f9">65</span>, <span style="color:#bd93f9">150</span>.<span style="color:#bd93f9">77</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-07&#39;</span>, <span style="color:#bd93f9">8200</span>.<span style="color:#bd93f9">50</span>, <span style="color:#bd93f9">58</span>, <span style="color:#bd93f9">141</span>.<span style="color:#bd93f9">39</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-08&#39;</span>, <span style="color:#bd93f9">13900</span>.<span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">95</span>, <span style="color:#bd93f9">146</span>.<span style="color:#bd93f9">32</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-09&#39;</span>, <span style="color:#bd93f9">16200</span>.<span style="color:#bd93f9">00</span>, <span style="color:#bd93f9">118</span>, <span style="color:#bd93f9">137</span>.<span style="color:#bd93f9">29</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;2025-12-10&#39;</span>, <span style="color:#bd93f9">14800</span>.<span style="color:#bd93f9">50</span>, <span style="color:#bd93f9">105</span>, <span style="color:#bd93f9">140</span>.<span style="color:#bd93f9">96</span>);
</span></span></code></pre></div><h3 id="queries-1">Queries</h3>
<p><strong>Hourly event counts by type (time-series):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    date_trunc(<span style="color:#f1fa8c">&#39;hour&#39;</span>, occurred_at) <span style="color:#ff79c6">AS</span> hour,
</span></span><span style="display:flex;"><span>    event_type,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> event_count
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> analytics_events
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> occurred_at <span style="color:#ff79c6">&gt;=</span> <span style="color:#f1fa8c">&#39;2025-12-15&#39;</span> <span style="color:#ff79c6">AND</span> occurred_at <span style="color:#ff79c6">&lt;</span> <span style="color:#f1fa8c">&#39;2025-12-16&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">2</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> hour                     | event_type   | event_count
</span></span><span style="display:flex;"><span>--------------------------+--------------+------------
</span></span><span style="display:flex;"><span> 2025-12-15 10:00:00+00   | add_to_cart  |           1
</span></span><span style="display:flex;"><span> 2025-12-15 10:00:00+00   | page_view    |           4
</span></span><span style="display:flex;"><span> 2025-12-15 10:00:00+00   | purchase     |           2
</span></span><span style="display:flex;"><span> 2025-12-15 10:00:00+00   | signup       |           1
</span></span></code></pre></div><p><strong>Conversion funnel analysis:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> funnel <span style="color:#ff79c6">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> <span style="color:#ff79c6">CASE</span> <span style="color:#ff79c6">WHEN</span> event_type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;page_view&#39;</span> <span style="color:#ff79c6">THEN</span> user_id <span style="color:#ff79c6">END</span>) <span style="color:#ff79c6">AS</span> viewers,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> <span style="color:#ff79c6">CASE</span> <span style="color:#ff79c6">WHEN</span> event_type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;add_to_cart&#39;</span> <span style="color:#ff79c6">THEN</span> user_id <span style="color:#ff79c6">END</span>) <span style="color:#ff79c6">AS</span> added_to_cart,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> <span style="color:#ff79c6">CASE</span> <span style="color:#ff79c6">WHEN</span> event_type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;purchase&#39;</span> <span style="color:#ff79c6">THEN</span> user_id <span style="color:#ff79c6">END</span>) <span style="color:#ff79c6">AS</span> purchasers
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">FROM</span> analytics_events
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WHERE</span> occurred_at <span style="color:#ff79c6">&gt;=</span> <span style="color:#f1fa8c">&#39;2025-12-15&#39;</span> <span style="color:#ff79c6">AND</span> occurred_at <span style="color:#ff79c6">&lt;</span> <span style="color:#f1fa8c">&#39;2025-12-16&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    viewers,
</span></span><span style="display:flex;"><span>    added_to_cart,
</span></span><span style="display:flex;"><span>    purchasers,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#bd93f9">100</span>.<span style="color:#bd93f9">0</span> <span style="color:#ff79c6">*</span> added_to_cart <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">NULLIF</span>(viewers, <span style="color:#bd93f9">0</span>), <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">AS</span> view_to_cart_pct,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#bd93f9">100</span>.<span style="color:#bd93f9">0</span> <span style="color:#ff79c6">*</span> purchasers <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">NULLIF</span>(added_to_cart, <span style="color:#bd93f9">0</span>), <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">AS</span> cart_to_purchase_pct
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> funnel;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> viewers | added_to_cart | purchasers | view_to_cart_pct | cart_to_purchase_pct
</span></span><span style="display:flex;"><span>---------+---------------+------------+------------------+---------------------
</span></span><span style="display:flex;"><span>       3 |             1 |          2 |             33.3 |                200.0
</span></span></code></pre></div><p><strong>Revenue trend with 7-day moving average:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">date</span>,
</span></span><span style="display:flex;"><span>    revenue,
</span></span><span style="display:flex;"><span>    orders,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">AVG</span>(revenue) OVER (
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#8be9fd;font-style:italic">date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">ROWS</span> <span style="color:#ff79c6">BETWEEN</span> <span style="color:#bd93f9">6</span> PRECEDING <span style="color:#ff79c6">AND</span> <span style="color:#ff79c6">CURRENT</span> <span style="color:#ff79c6">ROW</span>
</span></span><span style="display:flex;"><span>    ), <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> revenue_7d_avg,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">AVG</span>(orders) OVER (
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#8be9fd;font-style:italic">date</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">ROWS</span> <span style="color:#ff79c6">BETWEEN</span> <span style="color:#bd93f9">6</span> PRECEDING <span style="color:#ff79c6">AND</span> <span style="color:#ff79c6">CURRENT</span> <span style="color:#ff79c6">ROW</span>
</span></span><span style="display:flex;"><span>    ), <span style="color:#bd93f9">0</span>) <span style="color:#ff79c6">AS</span> orders_7d_avg
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> daily_revenue
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#8be9fd;font-style:italic">date</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> date       | revenue   | orders | revenue_7d_avg | orders_7d_avg
</span></span><span style="display:flex;"><span>------------+-----------+--------+----------------+--------------
</span></span><span style="display:flex;"><span> 2025-12-01 | 12450.00  |     85 |      12450.00  |           85
</span></span><span style="display:flex;"><span> 2025-12-02 | 14200.50  |    102 |      13325.25  |           94
</span></span><span style="display:flex;"><span> 2025-12-03 | 11890.25  |     78 |      12846.92  |           88
</span></span><span style="display:flex;"><span> 2025-12-04 | 15600.00  |    112 |      13535.19  |           94
</span></span><span style="display:flex;"><span> 2025-12-05 | 13100.75  |     91 |      13448.30  |           94
</span></span><span style="display:flex;"><span> 2025-12-06 |  9800.00  |     65 |      12840.25  |           89
</span></span><span style="display:flex;"><span> 2025-12-07 |  8200.50  |     58 |      12177.43  |           84
</span></span><span style="display:flex;"><span> 2025-12-08 | 13900.25  |     95 |      12384.61  |           86
</span></span><span style="display:flex;"><span> 2025-12-09 | 16200.00  |    118 |      12670.25  |           88
</span></span><span style="display:flex;"><span> 2025-12-10 | 14800.50  |    105 |      13086.00  |           92
</span></span></code></pre></div><p><strong>Device and country breakdown:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    device_type,
</span></span><span style="display:flex;"><span>    country,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> events,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> user_id) <span style="color:#ff79c6">AS</span> unique_users,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> session_id) <span style="color:#ff79c6">AS</span> sessions
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> analytics_events
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> occurred_at <span style="color:#ff79c6">&gt;=</span> <span style="color:#f1fa8c">&#39;2025-12-15&#39;</span> <span style="color:#ff79c6">AND</span> occurred_at <span style="color:#ff79c6">&lt;</span> <span style="color:#f1fa8c">&#39;2025-12-16&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> device_type, country
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> events <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> device_type | country | events | unique_users | sessions
</span></span><span style="display:flex;"><span>-------------+---------+--------+--------------+---------
</span></span><span style="display:flex;"><span> desktop     | US      |      4 |            2 |        2
</span></span><span style="display:flex;"><span> mobile      | GB      |      2 |            1 |        1
</span></span><span style="display:flex;"><span> tablet      | DE      |      2 |            1 |        1
</span></span></code></pre></div><hr>
<h2 id="3-aiml-rag-pipeline-vector-search">3. AI/ML RAG Pipeline (Vector Search)</h2>
<p>A retrieval-augmented generation (RAG) system that stores document embeddings alongside metadata and performs semantic search to provide context for LLM responses.</p>
<h3 id="description-2">Description</h3>
<p>RAG applications need to store text chunks with their vector embeddings, perform fast approximate nearest-neighbor (ANN) searches, and return the most relevant passages along with metadata. ThunderDB&rsquo;s native vector support eliminates the need for a separate vector database.</p>
<h3 id="schema-2">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Knowledge base documents
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> kb_documents (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    title       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">500</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    source_url  <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">1000</span>),
</span></span><span style="display:flex;"><span>    doc_type    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>),
</span></span><span style="display:flex;"><span>    created_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Document chunks with embeddings
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> kb_chunks (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    doc_id      <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> kb_documents(id),
</span></span><span style="display:flex;"><span>    chunk_index INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    content     <span style="color:#8be9fd;font-style:italic">TEXT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    token_count INT32,
</span></span><span style="display:flex;"><span>    embedding   VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>    metadata    JSONB
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- HNSW index for fast ANN search
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_chunks_embedding <span style="color:#ff79c6">ON</span> kb_chunks
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">USING</span> HNSW (embedding)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WITH</span> (m <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>, ef_construction <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">200</span>, distance_metric <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;cosine&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_chunks_doc <span style="color:#ff79c6">ON</span> kb_chunks (doc_id);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Chat history for context
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> chat_sessions (
</span></span><span style="display:flex;"><span>    id         UUID <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span> <span style="color:#ff79c6">DEFAULT</span> gen_random_uuid(),
</span></span><span style="display:flex;"><span>    user_id    <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    created_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> chat_messages (
</span></span><span style="display:flex;"><span>    id         <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    session_id UUID <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> chat_sessions(id),
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">role</span>       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    content    <span style="color:#8be9fd;font-style:italic">TEXT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    sources    JSONB,
</span></span><span style="display:flex;"><span>    created_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="sample-data-2">Sample Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Documents
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> kb_documents (id, title, source_url, doc_type) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;ThunderDB Architecture Overview&#39;</span>, <span style="color:#f1fa8c">&#39;https://docs.thunderdb.io/architecture&#39;</span>, <span style="color:#f1fa8c">&#39;documentation&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;Raft Consensus Protocol Explained&#39;</span>, <span style="color:#f1fa8c">&#39;https://docs.thunderdb.io/architecture/raft&#39;</span>, <span style="color:#f1fa8c">&#39;documentation&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;ThunderDB Query Optimization Guide&#39;</span>, <span style="color:#f1fa8c">&#39;https://docs.thunderdb.io/developer/optimization&#39;</span>, <span style="color:#f1fa8c">&#39;guide&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Chunks (embeddings truncated for readability -- actual embeddings are 1536-dim)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> kb_chunks (id, doc_id, chunk_index, content, token_count, embedding, metadata) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;ThunderDB uses a hybrid storage architecture with both row-oriented and columnar engines. The row engine is optimized for OLTP point lookups while the columnar engine excels at analytical scans.&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#bd93f9">38</span>, <span style="color:#f1fa8c">&#39;[0.021, -0.034, 0.089, ...]&#39;</span>::VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;{&#34;section&#34;: &#34;storage&#34;, &#34;heading&#34;: &#34;Hybrid Storage&#34;}&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">1</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;Data is automatically sharded across cluster nodes using consistent hashing. Each shard is replicated to three nodes for fault tolerance.&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#bd93f9">28</span>, <span style="color:#f1fa8c">&#39;[0.015, -0.067, 0.043, ...]&#39;</span>::VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;{&#34;section&#34;: &#34;sharding&#34;, &#34;heading&#34;: &#34;Data Distribution&#34;}&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;ThunderDB uses the Raft consensus protocol for leader election and log replication. Each Raft group manages a set of shards and ensures strong consistency.&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#bd93f9">32</span>, <span style="color:#f1fa8c">&#39;[-0.012, 0.045, 0.078, ...]&#39;</span>::VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;{&#34;section&#34;: &#34;consensus&#34;, &#34;heading&#34;: &#34;Raft Overview&#34;}&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">4</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">1</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;When a leader fails, Raft triggers an election. Followers with the most up-to-date log are preferred. Election completes within 150-300ms in typical deployments.&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#bd93f9">34</span>, <span style="color:#f1fa8c">&#39;[-0.008, 0.052, 0.061, ...]&#39;</span>::VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;{&#34;section&#34;: &#34;consensus&#34;, &#34;heading&#34;: &#34;Leader Election&#34;}&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;Use EXPLAIN ANALYZE to profile query execution. The output shows physical operators, estimated vs actual row counts, and time spent in each stage.&#39;</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#bd93f9">28</span>, <span style="color:#f1fa8c">&#39;[0.033, -0.019, 0.071, ...]&#39;</span>::VECTOR(<span style="color:#bd93f9">1536</span>),
</span></span><span style="display:flex;"><span>     <span style="color:#f1fa8c">&#39;{&#34;section&#34;: &#34;optimization&#34;, &#34;heading&#34;: &#34;Query Profiling&#34;}&#39;</span>);
</span></span></code></pre></div><h3 id="queries-2">Queries</h3>
<p><strong>Semantic search &ndash; find relevant chunks for a user question:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- User question: &#34;How does ThunderDB handle node failures?&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- First, generate the embedding for the question using your embedding model,
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">-- then search:
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SET</span> hnsw.ef_search <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">128</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">c</span>.id <span style="color:#ff79c6">AS</span> chunk_id,
</span></span><span style="display:flex;"><span>    d.title <span style="color:#ff79c6">AS</span> document,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">c</span>.content,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">c</span>.metadata<span style="color:#ff79c6">-&gt;&gt;</span><span style="color:#f1fa8c">&#39;heading&#39;</span> <span style="color:#ff79c6">AS</span> section,
</span></span><span style="display:flex;"><span>    <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-</span> (<span style="color:#ff79c6">c</span>.embedding <span style="color:#ff79c6">&lt;=&gt;</span> $<span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">AS</span> similarity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> kb_chunks <span style="color:#ff79c6">c</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> kb_documents d <span style="color:#ff79c6">ON</span> <span style="color:#ff79c6">c</span>.doc_id <span style="color:#ff79c6">=</span> d.id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">c</span>.embedding <span style="color:#ff79c6">&lt;=&gt;</span> $<span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LIMIT</span> <span style="color:#bd93f9">5</span>;
</span></span></code></pre></div><p><strong>Expected output</strong> (similarity scores depend on actual embeddings):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> chunk_id | document                          | content                                                    | section          | similarity
</span></span><span style="display:flex;"><span>----------+-----------------------------------+------------------------------------------------------------+------------------+-----------
</span></span><span style="display:flex;"><span>        4 | Raft Consensus Protocol Explained | When a leader fails, Raft triggers an election...          | Leader Election  |     0.9234
</span></span><span style="display:flex;"><span>        3 | Raft Consensus Protocol Explained | ThunderDB uses the Raft consensus protocol...              | Raft Overview    |     0.8876
</span></span><span style="display:flex;"><span>        2 | ThunderDB Architecture Overview   | Data is automatically sharded across cluster nodes...      | Data Distribution|     0.8543
</span></span><span style="display:flex;"><span>        1 | ThunderDB Architecture Overview   | ThunderDB uses a hybrid storage architecture...            | Hybrid Storage   |     0.7891
</span></span><span style="display:flex;"><span>        5 | ThunderDB Query Optimization Guide| Use EXPLAIN ANALYZE to profile query execution...          | Query Profiling  |     0.5123
</span></span></code></pre></div><p><strong>Filtered semantic search (search only documentation):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">c</span>.id <span style="color:#ff79c6">AS</span> chunk_id,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">c</span>.content,
</span></span><span style="display:flex;"><span>    <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">-</span> (<span style="color:#ff79c6">c</span>.embedding <span style="color:#ff79c6">&lt;=&gt;</span> $<span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">AS</span> similarity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> kb_chunks <span style="color:#ff79c6">c</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> kb_documents d <span style="color:#ff79c6">ON</span> <span style="color:#ff79c6">c</span>.doc_id <span style="color:#ff79c6">=</span> d.id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> d.doc_type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;documentation&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">c</span>.embedding <span style="color:#ff79c6">&lt;=&gt;</span> $<span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LIMIT</span> <span style="color:#bd93f9">3</span>;
</span></span></code></pre></div><p><strong>Store chat history with sources:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Create a session
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> chat_sessions (id, user_id)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#f1fa8c">&#39;550e8400-e29b-41d4-a716-446655440000&#39;</span>, <span style="color:#bd93f9">1001</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Store user message
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> chat_messages (id, session_id, <span style="color:#ff79c6">role</span>, content)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;550e8400-e29b-41d4-a716-446655440000&#39;</span>, <span style="color:#f1fa8c">&#39;user&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;How does ThunderDB handle node failures?&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Store assistant response with source references
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> chat_messages (id, session_id, <span style="color:#ff79c6">role</span>, content, sources)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">VALUES</span> (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;550e8400-e29b-41d4-a716-446655440000&#39;</span>, <span style="color:#f1fa8c">&#39;assistant&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;ThunderDB handles node failures through the Raft consensus protocol. When a leader node fails, Raft automatically triggers a leader election among the remaining nodes. Followers with the most up-to-date log are preferred as candidates. In typical deployments, a new leader is elected within 150-300ms, minimizing downtime.&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39;[{&#34;chunk_id&#34;: 4, &#34;document&#34;: &#34;Raft Consensus Protocol Explained&#34;, &#34;similarity&#34;: 0.9234},
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">          {&#34;chunk_id&#34;: 3, &#34;document&#34;: &#34;Raft Consensus Protocol Explained&#34;, &#34;similarity&#34;: 0.8876}]&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Retrieve conversation history
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">role</span>, content, sources
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> chat_messages
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> session_id <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;550e8400-e29b-41d4-a716-446655440000&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> created_at;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> role      | content                                                              | sources
</span></span><span style="display:flex;"><span>-----------+----------------------------------------------------------------------+----------------------------------------------------
</span></span><span style="display:flex;"><span> user      | How does ThunderDB handle node failures?                             | null
</span></span><span style="display:flex;"><span> assistant | ThunderDB handles node failures through the Raft consensus protocol. | [{&#34;chunk_id&#34;: 4, &#34;document&#34;: &#34;Raft Consensus ...}]
</span></span><span style="display:flex;"><span>           | When a leader node fails, Raft automatically triggers...             |
</span></span></code></pre></div><hr>
<h2 id="4-multi-database-federation-fdw">4. Multi-Database Federation (FDW)</h2>
<p>Joining data from PostgreSQL, MySQL, and MongoDB in a single ThunderDB query without ETL pipelines.</p>
<h3 id="description-3">Description</h3>
<p>Many organizations have data spread across multiple database systems. ThunderDB&rsquo;s foreign data wrappers let you query and join data from PostgreSQL, MySQL, MongoDB, and S3 as if it were local. ThunderDB pushes predicates down to remote systems to minimize data transfer.</p>
<h3 id="schema-3">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Connect to external PostgreSQL (user accounts)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> SERVER pg_accounts
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">TYPE</span> <span style="color:#f1fa8c">&#39;postgresql&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">OPTIONS</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span> <span style="color:#f1fa8c">&#39;10.0.1.50&#39;</span>, port <span style="color:#f1fa8c">&#39;5432&#39;</span>,
</span></span><span style="display:flex;"><span>        dbname <span style="color:#f1fa8c">&#39;accounts&#39;</span>, <span style="color:#ff79c6">user</span> <span style="color:#f1fa8c">&#39;readonly&#39;</span>, password <span style="color:#f1fa8c">&#39;secret&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">TABLE</span> remote_users (
</span></span><span style="display:flex;"><span>    id         <span style="color:#8be9fd;font-style:italic">BIGINT</span>,
</span></span><span style="display:flex;"><span>    name       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    email      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    plan       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>),
</span></span><span style="display:flex;"><span>    created_at TIMESTAMPTZ
</span></span><span style="display:flex;"><span>) SERVER pg_accounts
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">OPTIONS</span> (<span style="color:#ff79c6">schema</span> <span style="color:#f1fa8c">&#39;public&#39;</span>, <span style="color:#ff79c6">table</span> <span style="color:#f1fa8c">&#39;users&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Connect to external MySQL (legacy orders)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> SERVER mysql_orders
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">TYPE</span> <span style="color:#f1fa8c">&#39;mysql&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">OPTIONS</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">host</span> <span style="color:#f1fa8c">&#39;10.0.2.50&#39;</span>, port <span style="color:#f1fa8c">&#39;3306&#39;</span>,
</span></span><span style="display:flex;"><span>        dbname <span style="color:#f1fa8c">&#39;legacy_shop&#39;</span>, <span style="color:#ff79c6">user</span> <span style="color:#f1fa8c">&#39;reader&#39;</span>, password <span style="color:#f1fa8c">&#39;secret&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">TABLE</span> legacy_orders (
</span></span><span style="display:flex;"><span>    order_id     INT32,
</span></span><span style="display:flex;"><span>    customer_email <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    total        <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>    status       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>),
</span></span><span style="display:flex;"><span>    order_date   <span style="color:#8be9fd;font-style:italic">DATE</span>
</span></span><span style="display:flex;"><span>) SERVER mysql_orders
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">OPTIONS</span> (<span style="color:#ff79c6">table</span> <span style="color:#f1fa8c">&#39;orders&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Connect to external MongoDB (activity logs)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> SERVER mongo_activity
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">TYPE</span> <span style="color:#f1fa8c">&#39;mongodb&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">OPTIONS</span> (
</span></span><span style="display:flex;"><span>        connection_string <span style="color:#f1fa8c">&#39;mongodb://10.0.3.50:27017/activity&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">user</span> <span style="color:#f1fa8c">&#39;reader&#39;</span>, password <span style="color:#f1fa8c">&#39;secret&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">FOREIGN</span> <span style="color:#ff79c6">TABLE</span> activity_logs (
</span></span><span style="display:flex;"><span>    _id        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">24</span>),
</span></span><span style="display:flex;"><span>    user_email <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    action     <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>),
</span></span><span style="display:flex;"><span>    details    JSONB,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">timestamp</span>  TIMESTAMPTZ
</span></span><span style="display:flex;"><span>) SERVER mongo_activity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">OPTIONS</span> (collection <span style="color:#f1fa8c">&#39;user_actions&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Local ThunderDB table (enrichment data)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> user_segments (
</span></span><span style="display:flex;"><span>    user_email <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    segment    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    score      FLOAT64 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    updated_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="sample-data-3">Sample Data</h3>
<p>The foreign tables reference data in their respective external systems. The local table has:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> user_segments (user_email, segment, score) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;alice@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;high_value&#39;</span>, <span style="color:#bd93f9">95</span>.<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;bob@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;at_risk&#39;</span>, <span style="color:#bd93f9">32</span>.<span style="color:#bd93f9">1</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;carol@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;growing&#39;</span>, <span style="color:#bd93f9">67</span>.<span style="color:#bd93f9">8</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;dave@example.com&#39;</span>, <span style="color:#f1fa8c">&#39;new&#39;</span>, <span style="color:#bd93f9">15</span>.<span style="color:#bd93f9">5</span>);
</span></span></code></pre></div><h3 id="queries-3">Queries</h3>
<p><strong>Cross-database customer 360 view:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    u.name,
</span></span><span style="display:flex;"><span>    u.email,
</span></span><span style="display:flex;"><span>    u.plan,
</span></span><span style="display:flex;"><span>    s.segment,
</span></span><span style="display:flex;"><span>    s.score <span style="color:#ff79c6">AS</span> engagement_score,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> o.order_id) <span style="color:#ff79c6">AS</span> total_orders,
</span></span><span style="display:flex;"><span>    COALESCE(<span style="color:#ff79c6">SUM</span>(o.total), <span style="color:#bd93f9">0</span>) <span style="color:#ff79c6">AS</span> lifetime_value,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> a._id) <span style="color:#ff79c6">AS</span> activity_count,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">MAX</span>(a.<span style="color:#ff79c6">timestamp</span>) <span style="color:#ff79c6">AS</span> last_activity
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> remote_users u
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LEFT</span> <span style="color:#ff79c6">JOIN</span> legacy_orders o <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> o.customer_email
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LEFT</span> <span style="color:#ff79c6">JOIN</span> activity_logs a <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> a.user_email
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LEFT</span> <span style="color:#ff79c6">JOIN</span> user_segments s <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> s.user_email
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> u.name, u.email, u.plan, s.segment, s.score
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> lifetime_value <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> name          | email              | plan     | segment    | engagement_score | total_orders | lifetime_value | activity_count | last_activity
</span></span><span style="display:flex;"><span>---------------+--------------------+----------+------------+------------------+--------------+----------------+----------------+----------------------
</span></span><span style="display:flex;"><span> Alice Johnson | alice@example.com  | premium  | high_value |             95.2 |           12 |        2845.50 |             89 | 2025-12-15 09:45:00
</span></span><span style="display:flex;"><span> Carol White   | carol@example.com  | standard | growing    |             67.8 |            5 |         723.25 |             34 | 2025-12-14 18:22:00
</span></span><span style="display:flex;"><span> Bob Smith     | bob@example.com    | standard | at_risk    |             32.1 |            2 |         129.98 |              5 | 2025-11-20 11:10:00
</span></span><span style="display:flex;"><span> Dave Brown    | dave@example.com   | free     | new        |             15.5 |            0 |           0.00 |              2 | 2025-12-15 08:00:00
</span></span></code></pre></div><p><strong>Find at-risk users with declining activity:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> user_monthly_activity <span style="color:#ff79c6">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>        user_email,
</span></span><span style="display:flex;"><span>        date_trunc(<span style="color:#f1fa8c">&#39;month&#39;</span>, <span style="color:#ff79c6">timestamp</span>) <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">month</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> actions
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">FROM</span> activity_logs
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">timestamp</span> <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;3 months&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> user_email, date_trunc(<span style="color:#f1fa8c">&#39;month&#39;</span>, <span style="color:#ff79c6">timestamp</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    u.name,
</span></span><span style="display:flex;"><span>    u.email,
</span></span><span style="display:flex;"><span>    s.segment,
</span></span><span style="display:flex;"><span>    s.score,
</span></span><span style="display:flex;"><span>    curr.actions <span style="color:#ff79c6">AS</span> current_month_actions,
</span></span><span style="display:flex;"><span>    prev.actions <span style="color:#ff79c6">AS</span> prev_month_actions,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#bd93f9">100</span>.<span style="color:#bd93f9">0</span> <span style="color:#ff79c6">*</span> (curr.actions <span style="color:#ff79c6">-</span> prev.actions) <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">NULLIF</span>(prev.actions, <span style="color:#bd93f9">0</span>), <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">AS</span> activity_change_pct
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> remote_users u
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> user_segments s <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> s.user_email
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LEFT</span> <span style="color:#ff79c6">JOIN</span> user_monthly_activity curr
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> curr.user_email <span style="color:#ff79c6">AND</span> curr.<span style="color:#ff79c6">month</span> <span style="color:#ff79c6">=</span> date_trunc(<span style="color:#f1fa8c">&#39;month&#39;</span>, now())
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LEFT</span> <span style="color:#ff79c6">JOIN</span> user_monthly_activity prev
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">ON</span> u.email <span style="color:#ff79c6">=</span> prev.user_email <span style="color:#ff79c6">AND</span> prev.<span style="color:#ff79c6">month</span> <span style="color:#ff79c6">=</span> date_trunc(<span style="color:#f1fa8c">&#39;month&#39;</span>, now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;1 month&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> s.segment <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;at_risk&#39;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">OR</span> (curr.actions <span style="color:#ff79c6">&lt;</span> prev.actions <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> s.score <span style="color:#ff79c6">ASC</span>;
</span></span></code></pre></div><hr>
<h2 id="5-real-time-sync-cdc">5. Real-Time Sync (CDC)</h2>
<p>Streaming changes from a production PostgreSQL database into ThunderDB for real-time analytics, search, and enrichment.</p>
<h3 id="description-4">Description</h3>
<p>Change Data Capture (CDC) lets you subscribe to row-level changes on ThunderDB tables and consume them as a structured event stream. This example shows how to set up a pipeline that mirrors production data changes into an analytics-optimized representation and triggers downstream actions.</p>
<h3 id="schema-4">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Source table (receives real-time changes)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> orders (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    customer_id <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    product_id  <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    quantity    INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    total       <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    status      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#39;pending&#39;</span>,
</span></span><span style="display:flex;"><span>    created_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now(),
</span></span><span style="display:flex;"><span>    updated_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now()
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Analytics target (columnar for fast aggregation)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> orders_analytics (
</span></span><span style="display:flex;"><span>    order_id     <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    customer_id  <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    product_id   <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    quantity     INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    total        <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    status       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">day</span>          <span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    hour         INT32 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    is_high_value <span style="color:#8be9fd;font-style:italic">BOOLEAN</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#ff79c6">=</span> COLUMNAR;
</span></span></code></pre></div><h3 id="setting-up-cdc-subscriptions">Setting Up CDC Subscriptions</h3>
<p><strong>Via REST API &ndash; subscribe to order changes:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># Create a webhook subscription for order inserts and updates</span>
</span></span><span style="display:flex;"><span>curl -s http://localhost:8088/api/v1/subscriptions <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span>  -H <span style="color:#f1fa8c">&#34;Content-Type: application/json&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span>  -d <span style="color:#f1fa8c">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;name&#34;: &#34;orders_to_analytics&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;table&#34;: &#34;orders&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;events&#34;: [&#34;insert&#34;, &#34;update&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;delivery&#34;: &#34;webhook&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;endpoint&#34;: &#34;https://analytics-worker.internal/hooks/order-events&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;include_old_values&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;batch_size&#34;: 50,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;batch_timeout_ms&#34;: 2000,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;retry_policy&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">      &#34;max_retries&#34;: 10,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">      &#34;backoff_ms&#34;: 500,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">      &#34;backoff_multiplier&#34;: 2.0
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    }
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  }&#39;</span> | jq .
</span></span></code></pre></div><p><strong>Via WebSocket &ndash; consume events in real time:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wscat -c ws://localhost:8088/ws/events
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;type&#34;</span>: <span style="color:#f1fa8c">&#34;subscribe&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;orders_stream&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;table&#34;</span>: <span style="color:#f1fa8c">&#34;orders&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;events&#34;</span>: [<span style="color:#f1fa8c">&#34;insert&#34;</span>, <span style="color:#f1fa8c">&#34;update&#34;</span>, <span style="color:#f1fa8c">&#34;delete&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;filter&#34;</span>: <span style="color:#f1fa8c">&#34;total &gt; 0&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="simulating-changes">Simulating Changes</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- New orders arrive
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> orders (id, customer_id, product_id, quantity, total, status) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2001</span>, <span style="color:#bd93f9">101</span>, <span style="color:#bd93f9">42</span>, <span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">299</span>.<span style="color:#bd93f9">98</span>, <span style="color:#f1fa8c">&#39;pending&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2002</span>, <span style="color:#bd93f9">102</span>, <span style="color:#bd93f9">15</span>, <span style="color:#bd93f9">1</span>, <span style="color:#bd93f9">45</span>.<span style="color:#bd93f9">00</span>, <span style="color:#f1fa8c">&#39;pending&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2003</span>, <span style="color:#bd93f9">103</span>, <span style="color:#bd93f9">42</span>, <span style="color:#bd93f9">5</span>, <span style="color:#bd93f9">749</span>.<span style="color:#bd93f9">95</span>, <span style="color:#f1fa8c">&#39;pending&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Order status updates
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">UPDATE</span> orders <span style="color:#ff79c6">SET</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;confirmed&#39;</span>, updated_at <span style="color:#ff79c6">=</span> now() <span style="color:#ff79c6">WHERE</span> id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2001</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UPDATE</span> orders <span style="color:#ff79c6">SET</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;shipped&#39;</span>, updated_at <span style="color:#ff79c6">=</span> now() <span style="color:#ff79c6">WHERE</span> id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2001</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">UPDATE</span> orders <span style="color:#ff79c6">SET</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;cancelled&#39;</span>, updated_at <span style="color:#ff79c6">=</span> now() <span style="color:#ff79c6">WHERE</span> id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2002</span>;
</span></span></code></pre></div><h3 id="cdc-event-payloads">CDC Event Payloads</h3>
<p><strong>Insert event received via WebSocket:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;type&#34;</span>: <span style="color:#f1fa8c">&#34;event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;orders_stream&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;table&#34;</span>: <span style="color:#f1fa8c">&#34;orders&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;operation&#34;</span>: <span style="color:#f1fa8c">&#34;insert&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;row&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">2001</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;customer_id&#34;</span>: <span style="color:#bd93f9">101</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;product_id&#34;</span>: <span style="color:#bd93f9">42</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;quantity&#34;</span>: <span style="color:#bd93f9">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;total&#34;</span>: <span style="color:#bd93f9">299.98</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;pending&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;created_at&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:30:00Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:30:00Z&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;lsn&#34;</span>: <span style="color:#f1fa8c">&#34;0/2A000010&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;timestamp&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:30:00.001Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Update event with old values:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;type&#34;</span>: <span style="color:#f1fa8c">&#34;event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#f1fa8c">&#34;orders_stream&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;table&#34;</span>: <span style="color:#f1fa8c">&#34;orders&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;operation&#34;</span>: <span style="color:#f1fa8c">&#34;update&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;old_row&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">2001</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;pending&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:30:00Z&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;new_row&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">2001</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;confirmed&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:31:00Z&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;changed_columns&#34;</span>: [<span style="color:#f1fa8c">&#34;status&#34;</span>, <span style="color:#f1fa8c">&#34;updated_at&#34;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;lsn&#34;</span>: <span style="color:#f1fa8c">&#34;0/2A000020&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;timestamp&#34;</span>: <span style="color:#f1fa8c">&#34;2025-12-15T10:31:00.001Z&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="analytics-query-on-synced-data">Analytics Query on Synced Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Transform and insert into analytics table
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> orders_analytics (order_id, customer_id, product_id, quantity, total, status, <span style="color:#ff79c6">day</span>, hour, is_high_value)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    id, customer_id, product_id, quantity, total, status,
</span></span><span style="display:flex;"><span>    created_at::<span style="color:#8be9fd;font-style:italic">DATE</span> <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">day</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">EXTRACT</span>(HOUR <span style="color:#ff79c6">FROM</span> created_at)::INT32 <span style="color:#ff79c6">AS</span> hour,
</span></span><span style="display:flex;"><span>    total <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">200</span>.<span style="color:#bd93f9">00</span> <span style="color:#ff79c6">AS</span> is_high_value
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> orders;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Real-time dashboard query
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">day</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> total_orders,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) FILTER (<span style="color:#ff79c6">WHERE</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;confirmed&#39;</span>) <span style="color:#ff79c6">AS</span> confirmed,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) FILTER (<span style="color:#ff79c6">WHERE</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;shipped&#39;</span>) <span style="color:#ff79c6">AS</span> shipped,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) FILTER (<span style="color:#ff79c6">WHERE</span> status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;cancelled&#39;</span>) <span style="color:#ff79c6">AS</span> cancelled,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SUM</span>(total) <span style="color:#ff79c6">AS</span> total_revenue,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SUM</span>(total) FILTER (<span style="color:#ff79c6">WHERE</span> is_high_value) <span style="color:#ff79c6">AS</span> high_value_revenue
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> orders_analytics
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">day</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">CURRENT_DATE</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">day</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> day        | total_orders | confirmed | shipped | cancelled | total_revenue | high_value_revenue
</span></span><span style="display:flex;"><span>------------+--------------+-----------+---------+-----------+---------------+-------------------
</span></span><span style="display:flex;"><span> 2025-12-15 |            3 |         1 |       1 |         1 |       1094.93 |            1049.93
</span></span></code></pre></div><hr>
<h2 id="6-caching-layer-resp-protocol">6. Caching Layer (RESP Protocol)</h2>
<p>Using ThunderDB as a Redis-compatible cache that also supports SQL queries over cached data.</p>
<h3 id="description-5">Description</h3>
<p>ThunderDB&rsquo;s Redis protocol support lets you use it as a drop-in replacement for Redis in caching scenarios. The unique advantage is that data written via Redis commands can also be queried via SQL, enabling analytics over cached data and eliminating cache-database synchronization issues.</p>
<h3 id="schema-5">Schema</h3>
<p>ThunderDB automatically maps Redis data structures to internal tables. You can also create explicit tables and access them through both SQL and Redis protocols.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Explicit table for session data (accessible via both SQL and RESP)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> sessions (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">key</span>        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    user_id    <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    user_name  <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    user_email <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">role</span>       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>),
</span></span><span style="display:flex;"><span>    created_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now(),
</span></span><span style="display:flex;"><span>    expires_at TIMESTAMPTZ <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Cache table for frequently accessed products
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> product_cache (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">key</span>        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    name       <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>),
</span></span><span style="display:flex;"><span>    price      <span style="color:#8be9fd;font-style:italic">DECIMAL</span>(<span style="color:#bd93f9">10</span>,<span style="color:#bd93f9">2</span>),
</span></span><span style="display:flex;"><span>    stock      INT32,
</span></span><span style="display:flex;"><span>    category   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">100</span>),
</span></span><span style="display:flex;"><span>    cached_at  TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now(),
</span></span><span style="display:flex;"><span>    ttl        INT32
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="redis-operations">Redis Operations</h3>
<p><strong>Session management via Redis:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> redis
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#ff79c6">=</span> redis<span style="color:#ff79c6">.</span>Redis(host<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;localhost&#39;</span>, port<span style="color:#ff79c6">=</span><span style="color:#bd93f9">6379</span>, password<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;secret&#39;</span>, decode_responses<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Store a session (expires in 1 hour)</span>
</span></span><span style="display:flex;"><span>session_data <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_id&#34;</span>: <span style="color:#bd93f9">1001</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_name&#34;</span>: <span style="color:#f1fa8c">&#34;Alice Johnson&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_email&#34;</span>: <span style="color:#f1fa8c">&#34;alice@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;admin&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>r<span style="color:#ff79c6">.</span>setex(<span style="color:#f1fa8c">&#34;session:abc123&#34;</span>, <span style="color:#bd93f9">3600</span>, json<span style="color:#ff79c6">.</span>dumps(session_data))
</span></span><span style="display:flex;"><span>r<span style="color:#ff79c6">.</span>setex(<span style="color:#f1fa8c">&#34;session:def456&#34;</span>, <span style="color:#bd93f9">3600</span>, json<span style="color:#ff79c6">.</span>dumps({
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_id&#34;</span>: <span style="color:#bd93f9">1002</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_name&#34;</span>: <span style="color:#f1fa8c">&#34;Bob Smith&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_email&#34;</span>: <span style="color:#f1fa8c">&#34;bob@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;viewer&#34;</span>
</span></span><span style="display:flex;"><span>}))
</span></span><span style="display:flex;"><span>r<span style="color:#ff79c6">.</span>setex(<span style="color:#f1fa8c">&#34;session:ghi789&#34;</span>, <span style="color:#bd93f9">3600</span>, json<span style="color:#ff79c6">.</span>dumps({
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_id&#34;</span>: <span style="color:#bd93f9">1003</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_name&#34;</span>: <span style="color:#f1fa8c">&#34;Carol White&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;user_email&#34;</span>: <span style="color:#f1fa8c">&#34;carol@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;role&#34;</span>: <span style="color:#f1fa8c">&#34;editor&#34;</span>
</span></span><span style="display:flex;"><span>}))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Read a session</span>
</span></span><span style="display:flex;"><span>session <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(r<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;session:abc123&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;User: </span><span style="color:#f1fa8c">{</span>session[<span style="color:#f1fa8c">&#39;user_name&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> (</span><span style="color:#f1fa8c">{</span>session[<span style="color:#f1fa8c">&#39;role&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Product caching</span>
</span></span><span style="display:flex;"><span>products <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;product:101&#34;</span>: {<span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;Wireless Mouse&#34;</span>, <span style="color:#f1fa8c">&#34;price&#34;</span>: <span style="color:#bd93f9">29.99</span>, <span style="color:#f1fa8c">&#34;stock&#34;</span>: <span style="color:#bd93f9">500</span>, <span style="color:#f1fa8c">&#34;category&#34;</span>: <span style="color:#f1fa8c">&#34;electronics&#34;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;product:102&#34;</span>: {<span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;Mechanical Keyboard&#34;</span>, <span style="color:#f1fa8c">&#34;price&#34;</span>: <span style="color:#bd93f9">149.99</span>, <span style="color:#f1fa8c">&#34;stock&#34;</span>: <span style="color:#bd93f9">200</span>, <span style="color:#f1fa8c">&#34;category&#34;</span>: <span style="color:#f1fa8c">&#34;electronics&#34;</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;product:103&#34;</span>: {<span style="color:#f1fa8c">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;Python Cookbook&#34;</span>, <span style="color:#f1fa8c">&#34;price&#34;</span>: <span style="color:#bd93f9">45.00</span>, <span style="color:#f1fa8c">&#34;stock&#34;</span>: <span style="color:#bd93f9">1000</span>, <span style="color:#f1fa8c">&#34;category&#34;</span>: <span style="color:#f1fa8c">&#34;books&#34;</span>},
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pipe <span style="color:#ff79c6">=</span> r<span style="color:#ff79c6">.</span>pipeline()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> key, data <span style="color:#ff79c6">in</span> products<span style="color:#ff79c6">.</span>items():
</span></span><span style="display:flex;"><span>    pipe<span style="color:#ff79c6">.</span>hset(key, mapping<span style="color:#ff79c6">=</span>data)
</span></span><span style="display:flex;"><span>    pipe<span style="color:#ff79c6">.</span>expire(key, <span style="color:#bd93f9">900</span>)  <span style="color:#6272a4"># 15-minute cache TTL</span>
</span></span><span style="display:flex;"><span>pipe<span style="color:#ff79c6">.</span>execute()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Rate limiting</span>
</span></span><span style="display:flex;"><span>user_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;ratelimit:user:1001:api&#34;</span>
</span></span><span style="display:flex;"><span>current <span style="color:#ff79c6">=</span> r<span style="color:#ff79c6">.</span>incr(user_key)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> current <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>:
</span></span><span style="display:flex;"><span>    r<span style="color:#ff79c6">.</span>expire(user_key, <span style="color:#bd93f9">60</span>)  <span style="color:#6272a4"># Reset counter every 60 seconds</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> current <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">100</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;Rate limited!&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Request </span><span style="color:#f1fa8c">{</span>current<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/100&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Leaderboard</span>
</span></span><span style="display:flex;"><span>r<span style="color:#ff79c6">.</span>zadd(<span style="color:#f1fa8c">&#34;leaderboard:monthly&#34;</span>, {<span style="color:#f1fa8c">&#34;alice&#34;</span>: <span style="color:#bd93f9">2500</span>, <span style="color:#f1fa8c">&#34;bob&#34;</span>: <span style="color:#bd93f9">1800</span>, <span style="color:#f1fa8c">&#34;carol&#34;</span>: <span style="color:#bd93f9">3200</span>, <span style="color:#f1fa8c">&#34;dave&#34;</span>: <span style="color:#bd93f9">950</span>})
</span></span><span style="display:flex;"><span>top_3 <span style="color:#ff79c6">=</span> r<span style="color:#ff79c6">.</span>zrevrange(<span style="color:#f1fa8c">&#34;leaderboard:monthly&#34;</span>, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">2</span>, withscores<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> rank, (player, score) <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(top_3, <span style="color:#bd93f9">1</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;#</span><span style="color:#f1fa8c">{</span>rank<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> </span><span style="color:#f1fa8c">{</span>player<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>score<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
</span></span></code></pre></div><h3 id="sql-queries-over-cached-data">SQL Queries Over Cached Data</h3>
<p>The unique power of ThunderDB: query data written via Redis using SQL.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Find all active sessions
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">key</span>, user_name, <span style="color:#ff79c6">role</span>, created_at
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> thunder_cache.string_keys
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;session:%&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> expires_at <span style="color:#ff79c6">&gt;</span> now()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> created_at <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> key             | user_name     | role   | created_at
</span></span><span style="display:flex;"><span>-----------------+---------------+--------+-------------------------
</span></span><span style="display:flex;"><span> session:ghi789  | Carol White   | editor | 2025-12-15 10:30:02+00
</span></span><span style="display:flex;"><span> session:def456  | Bob Smith     | viewer | 2025-12-15 10:30:01+00
</span></span><span style="display:flex;"><span> session:abc123  | Alice Johnson | admin  | 2025-12-15 10:30:00+00
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Analytics: sessions by role
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    json_extract(value, <span style="color:#f1fa8c">&#39;$.role&#39;</span>) <span style="color:#ff79c6">AS</span> <span style="color:#ff79c6">role</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> session_count
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> thunder_cache.string_keys
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;session:%&#39;</span> <span style="color:#ff79c6">AND</span> expires_at <span style="color:#ff79c6">&gt;</span> now()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> json_extract(value, <span style="color:#f1fa8c">&#39;$.role&#39;</span>);
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> role   | session_count
</span></span><span style="display:flex;"><span>--------+--------------
</span></span><span style="display:flex;"><span> admin  |            1
</span></span><span style="display:flex;"><span> editor |            1
</span></span><span style="display:flex;"><span> viewer |            1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Product cache analytics: total value by category
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    category,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> product_count,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SUM</span>(price::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>) <span style="color:#ff79c6">AS</span> total_value,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SUM</span>(stock::INT32) <span style="color:#ff79c6">AS</span> total_stock
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> thunder_cache.hash_keys
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">LIKE</span> <span style="color:#f1fa8c">&#39;product:%&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> category;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> category    | product_count | total_value | total_stock
</span></span><span style="display:flex;"><span>-------------+---------------+-------------+------------
</span></span><span style="display:flex;"><span> electronics |             2 |      179.98 |         700
</span></span><span style="display:flex;"><span> books       |             1 |       45.00 |        1000
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Leaderboard query via SQL (sorted set data)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> member, score
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> thunder_cache.sorted_set_members
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">key</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;leaderboard:monthly&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> score <span style="color:#ff79c6">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">LIMIT</span> <span style="color:#bd93f9">5</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> member | score
</span></span><span style="display:flex;"><span>--------+------
</span></span><span style="display:flex;"><span> carol  |  3200
</span></span><span style="display:flex;"><span> alice  |  2500
</span></span><span style="display:flex;"><span> bob    |  1800
</span></span><span style="display:flex;"><span> dave   |   950
</span></span></code></pre></div><hr>
<h2 id="7-iot-data-platform">7. IoT Data Platform</h2>
<p>A time-series ingestion and analysis platform for sensor data from industrial IoT devices with real-time alerting.</p>
<h3 id="description-6">Description</h3>
<p>IoT platforms need to ingest high volumes of time-series data, run continuous aggregate queries for dashboards, and trigger alerts when sensor readings exceed thresholds. ThunderDB&rsquo;s columnar engine with BRIN indexes handles time-series data efficiently, and CDC subscriptions power the alerting system.</p>
<h3 id="schema-6">Schema</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Device registry
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> devices (
</span></span><span style="display:flex;"><span>    device_id   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    device_type <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">location</span>    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">100</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">zone</span>        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    installed_at TIMESTAMPTZ <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    status      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#39;active&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Sensor readings (columnar, time-series optimized)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> sensor_readings (
</span></span><span style="display:flex;"><span>    reading_id  <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    device_id   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    metric      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    value       FLOAT64 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    unit        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    quality     <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">10</span>) <span style="color:#ff79c6">DEFAULT</span> <span style="color:#f1fa8c">&#39;good&#39;</span>,
</span></span><span style="display:flex;"><span>    recorded_at TIMESTAMPTZ <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span>) ENGINE <span style="color:#ff79c6">=</span> COLUMNAR;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- BRIN index for time-range queries (very compact)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_readings_time <span style="color:#ff79c6">ON</span> sensor_readings <span style="color:#ff79c6">USING</span> BRIN (recorded_at)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WITH</span> (pages_per_range <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_readings_device <span style="color:#ff79c6">ON</span> sensor_readings (device_id);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">INDEX</span> idx_readings_metric <span style="color:#ff79c6">ON</span> sensor_readings (metric);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Alert rules
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> alert_rules (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    name        <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    device_id   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>),
</span></span><span style="display:flex;"><span>    metric      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    condition   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    threshold   FLOAT64 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    severity    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    enabled     <span style="color:#8be9fd;font-style:italic">BOOLEAN</span> <span style="color:#ff79c6">DEFAULT</span> <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Alert history
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">TABLE</span> alert_history (
</span></span><span style="display:flex;"><span>    id          <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">PRIMARY</span> <span style="color:#ff79c6">KEY</span>,
</span></span><span style="display:flex;"><span>    rule_id     <span style="color:#8be9fd;font-style:italic">BIGINT</span> <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">REFERENCES</span> alert_rules(id),
</span></span><span style="display:flex;"><span>    device_id   <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    metric      <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">50</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    value       FLOAT64 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    threshold   FLOAT64 <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    severity    <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">20</span>) <span style="color:#ff79c6">NOT</span> <span style="color:#ff79c6">NULL</span>,
</span></span><span style="display:flex;"><span>    message     <span style="color:#8be9fd;font-style:italic">TEXT</span>,
</span></span><span style="display:flex;"><span>    triggered_at TIMESTAMPTZ <span style="color:#ff79c6">DEFAULT</span> now(),
</span></span><span style="display:flex;"><span>    resolved_at  TIMESTAMPTZ
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="sample-data-4">Sample Data</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Devices
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> devices (device_id, device_type, <span style="color:#ff79c6">location</span>, <span style="color:#ff79c6">zone</span>, installed_at) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#f1fa8c">&#39;Building A, Floor 1&#39;</span>, <span style="color:#f1fa8c">&#39;zone-north&#39;</span>, <span style="color:#f1fa8c">&#39;2025-01-15&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-002&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#f1fa8c">&#39;Building A, Floor 2&#39;</span>, <span style="color:#f1fa8c">&#39;zone-north&#39;</span>, <span style="color:#f1fa8c">&#39;2025-01-15&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-003&#39;</span>, <span style="color:#f1fa8c">&#39;humidity&#39;</span>, <span style="color:#f1fa8c">&#39;Building A, Floor 1&#39;</span>, <span style="color:#f1fa8c">&#39;zone-north&#39;</span>, <span style="color:#f1fa8c">&#39;2025-01-15&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-004&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#f1fa8c">&#39;Building B, Floor 1&#39;</span>, <span style="color:#f1fa8c">&#39;zone-south&#39;</span>, <span style="color:#f1fa8c">&#39;2025-03-01&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-005&#39;</span>, <span style="color:#f1fa8c">&#39;pressure&#39;</span>, <span style="color:#f1fa8c">&#39;Building B, Floor 1&#39;</span>, <span style="color:#f1fa8c">&#39;zone-south&#39;</span>, <span style="color:#f1fa8c">&#39;2025-03-01&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#f1fa8c">&#39;sensor-006&#39;</span>, <span style="color:#f1fa8c">&#39;vibration&#39;</span>, <span style="color:#f1fa8c">&#39;Building B, Machine Room&#39;</span>, <span style="color:#f1fa8c">&#39;zone-south&#39;</span>, <span style="color:#f1fa8c">&#39;2025-06-01&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Sensor readings (simulated time-series data)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> sensor_readings (reading_id, device_id, metric, value, unit, quality, recorded_at) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">22</span>.<span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">22</span>.<span style="color:#bd93f9">7</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:01:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">23</span>.<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:02:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">28</span>.<span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:03:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">31</span>.<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:04:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">6</span>, <span style="color:#f1fa8c">&#39;sensor-002&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">21</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">7</span>, <span style="color:#f1fa8c">&#39;sensor-002&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">21</span>.<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:01:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">8</span>, <span style="color:#f1fa8c">&#39;sensor-002&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">21</span>.<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:02:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">9</span>, <span style="color:#f1fa8c">&#39;sensor-003&#39;</span>, <span style="color:#f1fa8c">&#39;humidity&#39;</span>, <span style="color:#bd93f9">45</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;percent&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">10</span>, <span style="color:#f1fa8c">&#39;sensor-003&#39;</span>, <span style="color:#f1fa8c">&#39;humidity&#39;</span>, <span style="color:#bd93f9">46</span>.<span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;percent&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:01:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">11</span>, <span style="color:#f1fa8c">&#39;sensor-003&#39;</span>, <span style="color:#f1fa8c">&#39;humidity&#39;</span>, <span style="color:#bd93f9">48</span>.<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;percent&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:02:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">12</span>, <span style="color:#f1fa8c">&#39;sensor-004&#39;</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#bd93f9">19</span>.<span style="color:#bd93f9">8</span>, <span style="color:#f1fa8c">&#39;celsius&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">13</span>, <span style="color:#f1fa8c">&#39;sensor-005&#39;</span>, <span style="color:#f1fa8c">&#39;pressure&#39;</span>, <span style="color:#bd93f9">1013</span>.<span style="color:#bd93f9">25</span>, <span style="color:#f1fa8c">&#39;hpa&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">14</span>, <span style="color:#f1fa8c">&#39;sensor-005&#39;</span>, <span style="color:#f1fa8c">&#39;pressure&#39;</span>, <span style="color:#bd93f9">1013</span>.<span style="color:#bd93f9">10</span>, <span style="color:#f1fa8c">&#39;hpa&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:01:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">15</span>, <span style="color:#f1fa8c">&#39;sensor-006&#39;</span>, <span style="color:#f1fa8c">&#39;vibration&#39;</span>, <span style="color:#bd93f9">0</span>.<span style="color:#bd93f9">5</span>, <span style="color:#f1fa8c">&#39;mm/s&#39;</span>, <span style="color:#f1fa8c">&#39;good&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">16</span>, <span style="color:#f1fa8c">&#39;sensor-006&#39;</span>, <span style="color:#f1fa8c">&#39;vibration&#39;</span>, <span style="color:#bd93f9">2</span>.<span style="color:#bd93f9">8</span>, <span style="color:#f1fa8c">&#39;mm/s&#39;</span>, <span style="color:#f1fa8c">&#39;degraded&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:01:00+00&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">17</span>, <span style="color:#f1fa8c">&#39;sensor-006&#39;</span>, <span style="color:#f1fa8c">&#39;vibration&#39;</span>, <span style="color:#bd93f9">5</span>.<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;mm/s&#39;</span>, <span style="color:#f1fa8c">&#39;degraded&#39;</span>, <span style="color:#f1fa8c">&#39;2025-12-15 10:02:00+00&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- Alert rules
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> alert_rules (id, name, device_id, metric, condition, threshold, severity) <span style="color:#ff79c6">VALUES</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#39;High temperature&#39;</span>, <span style="color:#ff79c6">NULL</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#f1fa8c">&#39;greater_than&#39;</span>, <span style="color:#bd93f9">30</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;warning&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">2</span>, <span style="color:#f1fa8c">&#39;Critical temperature&#39;</span>, <span style="color:#ff79c6">NULL</span>, <span style="color:#f1fa8c">&#39;temperature&#39;</span>, <span style="color:#f1fa8c">&#39;greater_than&#39;</span>, <span style="color:#bd93f9">40</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;critical&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">3</span>, <span style="color:#f1fa8c">&#39;High vibration&#39;</span>, <span style="color:#f1fa8c">&#39;sensor-006&#39;</span>, <span style="color:#f1fa8c">&#39;vibration&#39;</span>, <span style="color:#f1fa8c">&#39;greater_than&#39;</span>, <span style="color:#bd93f9">3</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;warning&#39;</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">4</span>, <span style="color:#f1fa8c">&#39;Low humidity&#39;</span>, <span style="color:#ff79c6">NULL</span>, <span style="color:#f1fa8c">&#39;humidity&#39;</span>, <span style="color:#f1fa8c">&#39;less_than&#39;</span>, <span style="color:#bd93f9">30</span>.<span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#39;info&#39;</span>);
</span></span></code></pre></div><h3 id="queries-4">Queries</h3>
<p><strong>Real-time dashboard: latest reading per device:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span> <span style="color:#ff79c6">DISTINCT</span> <span style="color:#ff79c6">ON</span> (device_id, metric)
</span></span><span style="display:flex;"><span>    d.device_id,
</span></span><span style="display:flex;"><span>    d.device_type,
</span></span><span style="display:flex;"><span>    d.<span style="color:#ff79c6">location</span>,
</span></span><span style="display:flex;"><span>    r.metric,
</span></span><span style="display:flex;"><span>    r.value,
</span></span><span style="display:flex;"><span>    r.unit,
</span></span><span style="display:flex;"><span>    r.quality,
</span></span><span style="display:flex;"><span>    r.recorded_at
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> sensor_readings r
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> devices d <span style="color:#ff79c6">ON</span> r.device_id <span style="color:#ff79c6">=</span> d.device_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> d.status <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;active&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> device_id, metric, recorded_at <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> device_id   | device_type | location                  | metric      | value   | unit    | quality  | recorded_at
</span></span><span style="display:flex;"><span>-------------+-------------+---------------------------+-------------+---------+---------+----------+-------------------------
</span></span><span style="display:flex;"><span> sensor-001  | temperature | Building A, Floor 1       | temperature |    31.2 | celsius | good     | 2025-12-15 10:04:00+00
</span></span><span style="display:flex;"><span> sensor-002  | temperature | Building A, Floor 2       | temperature |    21.1 | celsius | good     | 2025-12-15 10:02:00+00
</span></span><span style="display:flex;"><span> sensor-003  | humidity    | Building A, Floor 1       | humidity    |    48.2 | percent | good     | 2025-12-15 10:02:00+00
</span></span><span style="display:flex;"><span> sensor-004  | temperature | Building B, Floor 1       | temperature |    19.8 | celsius | good     | 2025-12-15 10:00:00+00
</span></span><span style="display:flex;"><span> sensor-005  | pressure    | Building B, Floor 1       | pressure    | 1013.10 | hpa     | good     | 2025-12-15 10:01:00+00
</span></span><span style="display:flex;"><span> sensor-006  | vibration   | Building B, Machine Room  | vibration   |     5.2 | mm/s    | degraded | 2025-12-15 10:02:00+00
</span></span></code></pre></div><p><strong>Time-series aggregation: 5-minute averages:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    device_id,
</span></span><span style="display:flex;"><span>    metric,
</span></span><span style="display:flex;"><span>    date_trunc(<span style="color:#f1fa8c">&#39;minute&#39;</span>, recorded_at)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">-</span> (<span style="color:#ff79c6">EXTRACT</span>(<span style="color:#ff79c6">MINUTE</span> <span style="color:#ff79c6">FROM</span> recorded_at)::INT32 <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">5</span>) <span style="color:#ff79c6">*</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;1 minute&#39;</span> <span style="color:#ff79c6">AS</span> bucket,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">AVG</span>(value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> avg_value,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">MIN</span>(value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> min_value,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">MAX</span>(value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> max_value,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> sample_count
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> sensor_readings
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> device_id <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;sensor-001&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> recorded_at <span style="color:#ff79c6">&gt;=</span> <span style="color:#f1fa8c">&#39;2025-12-15 10:00:00&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> recorded_at <span style="color:#ff79c6">&lt;</span> <span style="color:#f1fa8c">&#39;2025-12-15 10:10:00&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> device_id, metric, bucket
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> bucket;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> device_id  | metric      | bucket                   | avg_value | min_value | max_value | sample_count
</span></span><span style="display:flex;"><span>------------+-------------+--------------------------+-----------+-----------+-----------+-------------
</span></span><span style="display:flex;"><span> sensor-001 | temperature | 2025-12-15 10:00:00+00   |     25.60 |     22.50 |     31.20 |            5
</span></span></code></pre></div><p><strong>Anomaly detection: readings that deviate significantly from recent average:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">WITH</span> recent_stats <span style="color:#ff79c6">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>        device_id,
</span></span><span style="display:flex;"><span>        metric,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">AVG</span>(value) <span style="color:#ff79c6">AS</span> avg_value,
</span></span><span style="display:flex;"><span>        STDDEV(value) <span style="color:#ff79c6">AS</span> stddev_value
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">FROM</span> sensor_readings
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">WHERE</span> recorded_at <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;1 hour&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> device_id, metric
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    r.device_id,
</span></span><span style="display:flex;"><span>    d.<span style="color:#ff79c6">location</span>,
</span></span><span style="display:flex;"><span>    r.metric,
</span></span><span style="display:flex;"><span>    r.value,
</span></span><span style="display:flex;"><span>    r.unit,
</span></span><span style="display:flex;"><span>    ROUND((r.value <span style="color:#ff79c6">-</span> s.avg_value) <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">NULLIF</span>(s.stddev_value, <span style="color:#bd93f9">0</span>), <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> z_score,
</span></span><span style="display:flex;"><span>    r.recorded_at
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> sensor_readings r
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> recent_stats s <span style="color:#ff79c6">ON</span> r.device_id <span style="color:#ff79c6">=</span> s.device_id <span style="color:#ff79c6">AND</span> r.metric <span style="color:#ff79c6">=</span> s.metric
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> devices d <span style="color:#ff79c6">ON</span> r.device_id <span style="color:#ff79c6">=</span> d.device_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> <span style="color:#ff79c6">ABS</span>(r.value <span style="color:#ff79c6">-</span> s.avg_value) <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">*</span> s.stddev_value
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> r.recorded_at <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;10 minutes&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> <span style="color:#ff79c6">ABS</span>((r.value <span style="color:#ff79c6">-</span> s.avg_value) <span style="color:#ff79c6">/</span> <span style="color:#ff79c6">NULLIF</span>(s.stddev_value, <span style="color:#bd93f9">0</span>)) <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> device_id  | location                 | metric      | value | unit  | z_score | recorded_at
</span></span><span style="display:flex;"><span>------------+--------------------------+-------------+-------+-------+---------+-------------------------
</span></span><span style="display:flex;"><span> sensor-001 | Building A, Floor 1      | temperature | 31.20 | celsius |   2.35 | 2025-12-15 10:04:00+00
</span></span><span style="display:flex;"><span> sensor-006 | Building B, Machine Room | vibration   |  5.20 | mm/s    |   2.12 | 2025-12-15 10:02:00+00
</span></span></code></pre></div><p><strong>Trigger alerts for threshold violations:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#6272a4">-- Find readings that violate alert rules
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> alert_history (id, rule_id, device_id, metric, value, threshold, severity, message)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    nextval(<span style="color:#f1fa8c">&#39;alert_history_id_seq&#39;</span>),
</span></span><span style="display:flex;"><span>    ar.id,
</span></span><span style="display:flex;"><span>    r.device_id,
</span></span><span style="display:flex;"><span>    r.metric,
</span></span><span style="display:flex;"><span>    r.value,
</span></span><span style="display:flex;"><span>    ar.threshold,
</span></span><span style="display:flex;"><span>    ar.severity,
</span></span><span style="display:flex;"><span>    CONCAT(
</span></span><span style="display:flex;"><span>        ar.name, <span style="color:#f1fa8c">&#39;: &#39;</span>, r.device_id,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39; reading &#39;</span>, r.value, <span style="color:#f1fa8c">&#39; &#39;</span>, r.unit,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#39; exceeds threshold &#39;</span>, ar.threshold
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> sensor_readings r
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> alert_rules ar <span style="color:#ff79c6">ON</span> r.metric <span style="color:#ff79c6">=</span> ar.metric
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">AND</span> (ar.device_id <span style="color:#ff79c6">IS</span> <span style="color:#ff79c6">NULL</span> <span style="color:#ff79c6">OR</span> ar.device_id <span style="color:#ff79c6">=</span> r.device_id)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">AND</span> ar.enabled <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> r.recorded_at <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;5 minutes&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> (
</span></span><span style="display:flex;"><span>    (ar.condition <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;greater_than&#39;</span> <span style="color:#ff79c6">AND</span> r.value <span style="color:#ff79c6">&gt;</span> ar.threshold)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">OR</span> (ar.condition <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;less_than&#39;</span> <span style="color:#ff79c6">AND</span> r.value <span style="color:#ff79c6">&lt;</span> ar.threshold)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- View recent alerts
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    ah.severity,
</span></span><span style="display:flex;"><span>    ah.device_id,
</span></span><span style="display:flex;"><span>    d.<span style="color:#ff79c6">location</span>,
</span></span><span style="display:flex;"><span>    ah.metric,
</span></span><span style="display:flex;"><span>    ah.value,
</span></span><span style="display:flex;"><span>    ah.threshold,
</span></span><span style="display:flex;"><span>    ah.message,
</span></span><span style="display:flex;"><span>    ah.triggered_at
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> alert_history ah
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> devices d <span style="color:#ff79c6">ON</span> ah.device_id <span style="color:#ff79c6">=</span> d.device_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> ah.triggered_at <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;1 hour&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">AND</span> ah.resolved_at <span style="color:#ff79c6">IS</span> <span style="color:#ff79c6">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">CASE</span> ah.severity
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">WHEN</span> <span style="color:#f1fa8c">&#39;critical&#39;</span> <span style="color:#ff79c6">THEN</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">WHEN</span> <span style="color:#f1fa8c">&#39;warning&#39;</span> <span style="color:#ff79c6">THEN</span> <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">WHEN</span> <span style="color:#f1fa8c">&#39;info&#39;</span> <span style="color:#ff79c6">THEN</span> <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">END</span>,
</span></span><span style="display:flex;"><span>    ah.triggered_at <span style="color:#ff79c6">DESC</span>;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> severity | device_id  | location                 | metric      | value | threshold | message                                                          | triggered_at
</span></span><span style="display:flex;"><span>----------+------------+--------------------------+-------------+-------+-----------+------------------------------------------------------------------+-------------------------
</span></span><span style="display:flex;"><span> warning  | sensor-001 | Building A, Floor 1      | temperature | 31.20 |      30.0 | High temperature: sensor-001 reading 31.2 celsius exceeds 30.0   | 2025-12-15 10:04:00+00
</span></span><span style="display:flex;"><span> warning  | sensor-006 | Building B, Machine Room | vibration   |  5.20 |       3.0 | High vibration: sensor-006 reading 5.2 mm/s exceeds threshold 3.0| 2025-12-15 10:02:00+00
</span></span></code></pre></div><p><strong>Set up CDC for real-time alerting:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># Subscribe to sensor_readings for real-time alert evaluation</span>
</span></span><span style="display:flex;"><span>curl -s http://localhost:8088/api/v1/subscriptions <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span>  -H <span style="color:#f1fa8c">&#34;Content-Type: application/json&#34;</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span>  -d <span style="color:#f1fa8c">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;name&#34;: &#34;sensor_alert_pipeline&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;table&#34;: &#34;sensor_readings&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;events&#34;: [&#34;insert&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;delivery&#34;: &#34;webhook&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;endpoint&#34;: &#34;https://alerting.internal/hooks/evaluate&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;filter&#34;: &#34;quality != &#39;</span><span style="color:#f1fa8c">\&#39;</span><span style="color:#f1fa8c">&#39;bad&#39;</span><span style="color:#f1fa8c">\&#39;</span><span style="color:#f1fa8c">&#39;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;batch_size&#34;: 10,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;batch_timeout_ms&#34;: 1000
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  }&#39;</span> | jq .
</span></span></code></pre></div><p><strong>Zone-level summary for facility management:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff79c6">SELECT</span>
</span></span><span style="display:flex;"><span>    d.<span style="color:#ff79c6">zone</span>,
</span></span><span style="display:flex;"><span>    d.device_type,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">DISTINCT</span> d.device_id) <span style="color:#ff79c6">AS</span> device_count,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">AVG</span>(r.value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> avg_reading,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">MIN</span>(r.value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> min_reading,
</span></span><span style="display:flex;"><span>    ROUND(<span style="color:#ff79c6">MAX</span>(r.value)::<span style="color:#8be9fd;font-style:italic">DECIMAL</span>, <span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">AS</span> max_reading,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) <span style="color:#ff79c6">AS</span> total_readings,
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">COUNT</span>(<span style="color:#ff79c6">*</span>) FILTER (<span style="color:#ff79c6">WHERE</span> r.quality <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;degraded&#39;</span>) <span style="color:#ff79c6">AS</span> degraded_readings
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">FROM</span> devices d
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">JOIN</span> sensor_readings r <span style="color:#ff79c6">ON</span> d.device_id <span style="color:#ff79c6">=</span> r.device_id
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">WHERE</span> r.recorded_at <span style="color:#ff79c6">&gt;=</span> now() <span style="color:#ff79c6">-</span> <span style="color:#8be9fd;font-style:italic">INTERVAL</span> <span style="color:#f1fa8c">&#39;1 hour&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">GROUP</span> <span style="color:#ff79c6">BY</span> d.<span style="color:#ff79c6">zone</span>, d.device_type
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">ORDER</span> <span style="color:#ff79c6">BY</span> d.<span style="color:#ff79c6">zone</span>, d.device_type;
</span></span></code></pre></div><p><strong>Expected output:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span> zone       | device_type | device_count | avg_reading | min_reading | max_reading | total_readings | degraded_readings
</span></span><span style="display:flex;"><span>------------+-------------+--------------+-------------+-------------+-------------+----------------+------------------
</span></span><span style="display:flex;"><span> zone-north | humidity    |            1 |       46.57 |       45.00 |       48.20 |              3 |                 0
</span></span><span style="display:flex;"><span> zone-north | temperature |            2 |       23.64 |       21.00 |       31.20 |              8 |                 0
</span></span><span style="display:flex;"><span> zone-south | pressure    |            1 |     1013.18 |     1013.10 |     1013.25 |              2 |                 0
</span></span><span style="display:flex;"><span> zone-south | temperature |            1 |       19.80 |       19.80 |       19.80 |              1 |                 0
</span></span><span style="display:flex;"><span> zone-south | vibration   |            1 |        2.83 |        0.50 |        5.20 |              3 |                 2
</span></span></code></pre></div>
	<div class="section-index">
    
    
    </div>
<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="d-print-none">
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! <a href="https://github.com/thunderdb/thunderdb/issues/new">Tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. <a href="https://github.com/thunderdb/thunderdb/issues/new">Tell us how we can improve</a>.
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof gtag !== 'function') return;
    gtag('event', 'page_helpful', {
      'event_category': 'Helpful',
      'event_label': window.location.pathname,
      'value': value
    });
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback( 100 );
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>
<br />
</div>

          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/thunderdb/thunderdb" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discussions" aria-label="Discussions">
    <a target="_blank" rel="noopener" href="https://github.com/thunderdb/thunderdb/discussions" aria-label="Discussions">
      <i class="fas fa-comments"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2026
    <span class="td-footer__authors">ThunderDB Contributors</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><p class="td-footer__about mt-2"><a href="/docs/about/">About ThunderDB</a></p>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/docs/js/main.js"></script>
<script defer src="/docs/js/click-to-copy.js" crossorigin="anonymous"></script>
<script src='/docs/js/tabpane-persist.js'></script>

  </body>
</html>